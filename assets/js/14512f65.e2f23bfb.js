"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[4],{4252:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=r(7624),t=r(2172);const i={},o="finops-operator-scraper",s={id:"key-concepts/kcf/finops-components/finops-operator-scraper",title:"finops-operator-scraper",description:"This repository is part of the wider exporting architecture for the Krateo Composable FinOps and manages the creation of the scrapers reading the FOCUS cost reports from the Prometheus Exporters.",source:"@site/docs/20-key-concepts/30-kcf/10-finops-components/20-finops-operator-scraper.md",sourceDirName:"20-key-concepts/30-kcf/10-finops-components",slug:"/key-concepts/kcf/finops-components/finops-operator-scraper",permalink:"/key-concepts/kcf/finops-components/finops-operator-scraper",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"finops-operator-exporter",permalink:"/key-concepts/kcf/finops-components/finops-operator-exporter"},next:{title:"finops-operator-focus",permalink:"/key-concepts/kcf/finops-components/finops-operator-focus"}},c={},p=[{value:"Summary",id:"summary",level:2},{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Examples",id:"examples",level:2},{value:"Example Use Case for Pricing Visualization",id:"example-use-case-for-pricing-visualization",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Installation with HELM",id:"installation-with-helm",level:3},{value:"Configuration",id:"configuration-1",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"finops-operator-scraper",children:"finops-operator-scraper"}),"\n",(0,a.jsx)(n.p,{children:"This repository is part of the wider exporting architecture for the Krateo Composable FinOps and manages the creation of the scrapers reading the FOCUS cost reports from the Prometheus Exporters."}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#architecture",children:"Architecture"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#examples",children:"Examples"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#configuration",children:"Configuration"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:'This component is tasked with the creation of a generic scraper, according to the description given in a Custom Resource (CR). After the creation of the CR, the operator reads the "scraper" configuration part and creates two resources: a deployment with a generic prometheus scraper inside and a configmap containing the configuration. The scraper parses the prometheus data and obtains the given database-config to upload all metrics to a database.'}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Krateo Composable FinOps Operator Scraper",src:r(8252).c+"",width:"1980",height:"683"})}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: finops.krateo.io/v1\nkind: DatabaseConfig\nmetadata:\n  name: # DatabaseConfig name\n  namespace: # DatabaseConfig namespace\nspec:\n  username: # username string\n  passwordSecretRef: # object reference to secret with password\n    name: # secret name\n    namespace: # secret namespace\n    key: # secret key\n---\napiVersion: finops.krateo.io/v1\nkind: ScraperConfig\nmetadata:\n  name: # ScraperConfig name\n  namespace: # ScraperConfig namespace\nspec:\n  scraperConfig:\n    tableName: # tableName in the database to upload the data to\n    api: # the API to call with the prometheus exporter\n      path: # the path inside the domain\n      verb: GET # the method to call the API with\n      endpointRef: # secret with the url in the format http(s)://host:port\n        name: \n        namespace:\n    pollingInterval: # time duration, e.g., 12h30m\n    scraperDatabaseConfigRef: # See above kind DatabaseConfig\n      name: # name of the databaseConfigRef CR \n      namespace: # namespace of the databaseConfigRef CR\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-use-case-for-pricing-visualization",children:"Example Use Case for Pricing Visualization"}),"\n",(0,a.jsxs)(n.p,{children:["The Composable FinOps can be used to display pricing in the Krateo Composable Portal cards through a dedicated composition. You can find out more here: ",(0,a.jsx)(n.a,{href:"https://github.com/krateoplatformops/krateo-v2-template-finops-example-pricing-vm-azure",children:"krateo-v2-template-finops-example-pricing-vm-azure"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"go version v1.21.0+"}),"\n",(0,a.jsx)(n.li,{children:"docker version 17.03+."}),"\n",(0,a.jsx)(n.li,{children:"kubectl version v1.11.3+."}),"\n",(0,a.jsx)(n.li,{children:"Access to a Kubernetes v1.11.3+ cluster."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,a.jsxs)(n.p,{children:["You need to install CrateDB in the cluster and configure the ",(0,a.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler",children:"finops-database-handler"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"installation-with-helm",children:"Installation with HELM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ helm repo add krateo https://charts.krateo.io\n$ helm repo update krateo\n$ helm install finops-operator-scraper krateo/finops-operator-scraper\n"})}),"\n",(0,a.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,a.jsx)(n.p,{children:"The database-config CR is required."}),"\n",(0,a.jsxs)(n.p,{children:["The scraper container is created in the namespace of the CR. The scraper container looks for a secret in the CR namespace called ",(0,a.jsx)(n.code,{children:"registry-credentials"}),", configurable in the HELM chart."]})]})}function h(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8252:(e,n,r)=>{r.d(n,{c:()=>a});const a=r.p+"assets/images/KCF-operator-scraper-c487e6781ada1f4a5099886ceff105ed.png"},2172:(e,n,r)=>{r.d(n,{I:()=>s,M:()=>o});var a=r(1504);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);