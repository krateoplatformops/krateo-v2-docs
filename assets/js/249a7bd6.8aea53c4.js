"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[5144],{6468:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var o=n(7624),i=n(2172);const a={description:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0",sidebar_label:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0"},r="Migrating Krateo PlatformOps from v2.6.0 to v2.7.0",s={id:"how-to-guides/migrate-krateo/migrating-from-v2-6-0-to-v2-7-0",title:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0",description:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0",source:"@site/docs/30-how-to-guides/20-migrate-krateo/12-migrating-from-v2-6-0-to-v2-7-0.md",sourceDirName:"30-how-to-guides/20-migrate-krateo",slug:"/how-to-guides/migrate-krateo/migrating-from-v2-6-0-to-v2-7-0",permalink:"/how-to-guides/migrate-krateo/migrating-from-v2-6-0-to-v2-7-0",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:12,frontMatter:{description:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0",sidebar_label:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0"},sidebar:"tutorialSidebar",previous:{title:"Migrating Krateo PlatformOps from v2.5.1 to v2.6.0 (AKS example)",permalink:"/how-to-guides/migrate-krateo/migrating-from-v2-5-1-to-v2-6-0"},next:{title:"Migrating from Crossplane Composition to Helm",permalink:"/how-to-guides/migrate-krateo/migrating-from-crossplane-composition-to-helm"}},l={},p=[{value:"Starting point: Krateo 2.6.0",id:"starting-point-krateo-260",level:2},{value:"Upgrade to Krateo 2.7.0",id:"upgrade-to-krateo-270",level:2},{value:"Templates migration",id:"templates-migration",level:2},{value:"Install the <code>GithubScaffoldingWithCompositionPage</code> Blueprint using Composable Portal",id:"install-the-githubscaffoldingwithcompositionpage-blueprint-using-composable-portal",level:3},{value:"Migrate the <code>GithubScaffoldingWithCompositionPage</code> Blueprint to use the new frontend",id:"migrate-the-githubscaffoldingwithcompositionpage-blueprint-to-use-the-new-frontend",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.M)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"migrating-krateo-platformops-from-v260-to-v270",children:"Migrating Krateo PlatformOps from v2.6.0 to v2.7.0"}),"\n",(0,o.jsxs)(t.p,{children:["This guide is focused on migrating an existing Krateo PlatformOps installation from version 2.6.0 to version 2.7.0.\nThe examples is based on an AKS cluster (in particular the install/upgrade commands are taken from the ",(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-via-loadbalancer",children:'"How to Guides/Install Krateo"'}),"), but the steps remains the same for other supported Kubernetes distributions.\nYou only need to adapt the installation commands to your environment."]}),"\n",(0,o.jsx)(t.p,{children:"Here the links to the installation guides for other Kubernetes distributions:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-via-loadbalancer",children:"K8s with LoadBalancer"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-via-ingress",children:"K8s with Ingress"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-with-envvars",children:"K8s with EnvVars"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-with-securitycontext",children:"K8s with SecurityContext"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-openshift",children:"Openshift"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/how-to-guides/install-krateo/installing-krateo-kind",children:"Kind"})}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"Skip this section if you already have Krateo v2.6.0 installed."})}),"\n",(0,o.jsxs)(t.p,{children:["The Krateo 2.7.0 release notes are available ",(0,o.jsx)(t.a,{href:"/release-notes/release-note-2-7-0",children:"here"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["In this guide, we will leverage the updated ",(0,o.jsx)(t.a,{href:"https://github.com/krateoplatformops-blueprints/portal-composition-page-generic/tree/1.4.0",children:"portal-composition-page-generic"}),", which is our opinionated and agnostic Composition page that displays Composition information such as Events, Status of the managed resources, and Values."]}),"\n",(0,o.jsxs)(t.p,{children:["We will also leverage the ",(0,o.jsx)(t.code,{children:"portal-blueprint-page"})," to add the Blueprint to the catalog."]}),"\n",(0,o.jsx)(t.h2,{id:"starting-point-krateo-260",children:"Starting point: Krateo 2.6.0"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"helm upgrade installer-crd installer-crd \\\n  --repo [https://charts.krateo.io](https://charts.krateo.io) \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --install \\\n  --version 2.6.0 \\\n  --wait\n\nhelm upgrade installer installer \\\n  --repo [https://charts.krateo.io](https://charts.krateo.io) \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --set krateoplatformops.service.type=LoadBalancer \\\n  --set krateoplatformops.service.externalIpAvailable=true \\\n  --set krateoplatformops.finopscratedb.openshift.enabled=true \\\n  --install \\\n  --version 2.6.0 \\\n  --wait\n\n"})}),"\n",(0,o.jsx)(t.p,{children:"Wait for Krateo PlatformOps to be up and running:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl wait krateoplatformops krateo --for condition=Ready=True --namespace krateo-system --timeout=500s\n"})}),"\n",(0,o.jsx)(t.p,{children:"Get the login page URL:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl get svc frontend -n krateo-system  -o=jsonpath='{.status.loadBalancer.ingress[0].hostname}'\n"})}),"\n",(0,o.jsxs)(t.p,{children:["This is the ",(0,o.jsx)(t.code,{children:"login"})," page of Krateo 2.6.0:"]}),"\n",(0,o.jsx)(t.p,{children:"Login with the new password generated for the admin user:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:'kubectl get secret admin-password  -n krateo-system -o jsonpath="{.data.password}" | base64 -d\n'})}),"\n",(0,o.jsx)(t.h2,{id:"upgrade-to-krateo-270",children:"Upgrade to Krateo 2.7.0"}),"\n",(0,o.jsx)(t.p,{children:"Let's upgrade Krateo from v2.6.0 to v2.7.0 on AKS using the following commands:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"helm upgrade installer-crd installer-crd \\\n  --repo [https://charts.krateo.io](https://charts.krateo.io) \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --install \\\n  --version 2.7.0 \\\n  --wait\n\nhelm upgrade installer installer \\\n  --repo [https://charts.krateo.io](https://charts.krateo.io) \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --set krateoplatformops.service.type=LoadBalancer \\\n  --set krateoplatformops.service.externalIpAvailable=true \\\n  --install \\\n  --version 2.7.0 \\\n  --wait\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"The LoadBalancer IP for the Portal will change."})}),"\n",(0,o.jsx)(t.p,{children:"Login with the new password generated for the admin user:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:'kubectl get secret admin-password  -n krateo-system -o jsonpath="{.data.password}" | base64 -d\n'})}),"\n",(0,o.jsx)(t.h2,{id:"templates-migration",children:"Templates migration"}),"\n",(0,o.jsx)(t.p,{children:"In this section, we will explain how to migrate existing Blueprints to leverage the new frontend introduced in Krateo v2.7.0."}),"\n",(0,o.jsxs)(t.p,{children:["We will migrate the blueprint ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," deployed via the ",(0,o.jsx)(t.code,{children:"portal-blueprint-page"})," blueprint."]}),"\n",(0,o.jsxs)(t.h3,{id:"install-the-githubscaffoldingwithcompositionpage-blueprint-using-composable-portal",children:["Install the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint using Composable Portal"]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["Skip this section if you already have the ",(0,o.jsx)(t.a,{href:"https://github.com/krateoplatformops-blueprints/github-scaffolding-with-composition-page/tree/1.2.1",children:(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})})," and the ",(0,o.jsx)(t.code,{children:"portal-blueprint-page"})," installed from Krateo v2.6.0."]})}),"\n",(0,o.jsxs)(t.p,{children:["First, let's add the ",(0,o.jsx)(t.code,{children:"portal-blueprint-page"})," to the catalog:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: portal-blueprint-page\n  namespace: krateo-system\nspec:\n  chart:\n    repo: portal-blueprint-page\n    url: [https://marketplace.krateo.io](https://marketplace.krateo.io)\n    version: 1.0.5\nEOF\n\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Wait for the ",(0,o.jsx)(t.code,{children:"CompositionDefinition"})," to be ready:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl wait compositiondefinition portal-blueprint-page --for condition=Ready=True --namespace krateo-system --timeout=500s\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now we can add the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint to the catalog:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v1-0-5\nkind: PortalBlueprintPage\nmetadata:\n  name: github-scaffolding-with-composition-page\n  namespace: demo-system\nspec:\n  blueprint:\n    url: [https://marketplace.krateo.io](https://marketplace.krateo.io)\n    version: 1.1.0 # this is the Blueprint version\n    hasPage: true\n  form:\n    alphabeticalOrder: false\n  panel:\n    title: GitHub Scaffolding with Composition Page\n    icon:\n      name: fa-cubes\nEOF\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Wait for the ",(0,o.jsx)(t.code,{children:"PortalBlueprintPage"})," to be ready:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl wait portalblueprintpage github-scaffolding-with-composition-page --for condition=Ready=True --namespace demo-system --timeout=500s\n"})}),"\n",(0,o.jsx)(t.p,{children:'A panel called "Github Scaffolding with Composition Page" should now be available in the Krateo Composable Portal under the Blueprints section.'}),"\n",(0,o.jsxs)(t.p,{children:["You can now create a new Composition leveraging the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint."]}),"\n",(0,o.jsxs)(t.h3,{id:"migrate-the-githubscaffoldingwithcompositionpage-blueprint-to-use-the-new-frontend",children:["Migrate the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint to use the new frontend"]}),"\n",(0,o.jsxs)(t.p,{children:["Update the ",(0,o.jsx)(t.code,{children:"portal-blueprint-page"})," to the new version."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: portal-blueprint-page\n  namespace: krateo-system\nspec:\n  chart:\n    repo: portal-blueprint-page\n    url: [https://marketplace.krateo.io](https://marketplace.krateo.io)\n    version: 1.0.6\nEOF\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Wait for the ",(0,o.jsx)(t.code,{children:"CompositionDefinition"})," to be ready:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl wait compositiondefinition portal-blueprint-page --for condition=Ready=True --namespace krateo-system --timeout=500s\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now let's update the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint to use the new frontend:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:'kubectl patch portalblueprintpage.composition.krateo.io/github-scaffolding-with-composition-page -n demo-system --type=\'json\' -p=\'[{"op": "replace", "path": "/spec/blueprint/version", "value": "1.2.1"}]\'\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Wait for the ",(0,o.jsx)(t.code,{children:"PortalBlueprintPage"})," to be ready:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sh",children:"kubectl wait portalblueprintpage github-scaffolding-with-composition-page --for condition=Ready=True --namespace demo-system --timeout=500s\n"})}),"\n",(0,o.jsxs)(t.p,{children:["At this point, any new Composition created with the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint will leverage the new frontend introduced in Krateo v2.7.0."]}),"\n",(0,o.jsxs)(t.p,{children:["The most important change is in the ",(0,o.jsx)(t.code,{children:"GithubScaffoldingWithCompositionPage"})," Blueprint, where the Composition page has been updated to use ",(0,o.jsxs)(t.a,{href:"https://github.com/krateoplatformops-blueprints/portal-composition-page-generic/releases/tag/1.4.0",children:["the new ",(0,o.jsx)(t.code,{children:"portal-composition-page-generic"})," Composition"]})," page."]}),"\n",(0,o.jsxs)(t.p,{children:["The default route in the ",(0,o.jsx)(t.code,{children:"demo-system"})," has been changed in the ",(0,o.jsx)(t.code,{children:"Portal"})," Blueprint to avoid duplicate routes for compositions with the same name (but different Kind); the ",(0,o.jsx)(t.code,{children:"portal-composition-page-generic"})," Blueprint has been updated to support this new routing mechanism."]})]})}function h(e={}){const{wrapper:t}={...(0,i.M)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},2172:(e,t,n)=>{n.d(t,{I:()=>s,M:()=>r});var o=n(1504);const i={},a=o.createContext(i);function r(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);