"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[9664],{4488:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>n,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var a=i(7624),s=i(2172);const o={description:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)",sidebar_label:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)"},n="Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)",r={id:"how-to-guides/migrate-krateo/migrating-from-v2-4-3-to-v2-5-0",title:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)",description:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)",source:"@site/docs/30-how-to-guides/20-migrate-krateo/10-migrating-from-v2-4-3-to-v2-5-0.md",sourceDirName:"30-how-to-guides/20-migrate-krateo",slug:"/how-to-guides/migrate-krateo/migrating-from-v2-4-3-to-v2-5-0",permalink:"/how-to-guides/migrate-krateo/migrating-from-v2-4-3-to-v2-5-0",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{description:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)",sidebar_label:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)"},sidebar:"tutorialSidebar",previous:{title:"Installing Krateo PlatformOps using security context",permalink:"/how-to-guides/install-krateo/installing-krateo-with-securitycontext"},next:{title:"Migrating Krateo PlatformOps from v2.5.0 to v2.5.1 (AKS example)",permalink:"/how-to-guides/migrate-krateo/migrating-from-v2-5-0-to-v2-5-1"}},c={},p=[{value:"Starting point: Krateo 2.4.3, Fireworksapp compositiondefinition 1.1.15, fireworksapp-tomigrate composition",id:"starting-point-krateo-243-fireworksapp-compositiondefinition-1115-fireworksapp-tomigrate-composition",level:2},{value:"Ending point: Krateo 2.5.0, Fireworksapp compositiondefinition 2.0.2 (version changed within the same compositiondefinition, previous fireworksapp-tomigrate composition",id:"ending-point-krateo-250-fireworksapp-compositiondefinition-202-version-changed-within-the-same-compositiondefinition-previous-fireworksapp-tomigrate-composition",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"migrating-krateo-platformops-from-v243-to-v250-aks-example",children:"Migrating Krateo PlatformOps from v2.4.3 to v2.5.0 (AKS example)"}),"\n",(0,a.jsx)(t.p,{children:"Krateo 2.5.0 introduces a new set of manifests to declare widgets in the portal. The difference with the previous version resides in the following:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"API orchestration has been decoupled from the data preparation for the portal. This assumption requires implementing a RESTAction that the widget will reference"}),"\n",(0,a.jsx)(t.li,{children:"New widgets are strongly typified, meaning that there is a specific Kind for a particular widget, and properties are expressed in the dedicated CRD"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The schema for widgets until the 2.4.3 version is the following:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"apiVersion: templates.krateo.io/v1alpha1\nkind: Collection\nspec:\n  type: panel\n  propsRef:\n  widgetsRefs: []\n---\napiVersion: templates.krateo.io/v1alpha1\nkind: Widget\nspec:\n  type:\n  propsRef:\n  app:\n    template:\n  API: []\n  actions: []\n"})}),"\n",(0,a.jsx)(t.p,{children:"The schema for widget from 2.5.0 version is the following:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"kind: LineChart\napiVersion: widgets.templates.krateo.io/v1beta1\nspec:\n  widgetData:\n  apiRef: \n  widgetDataTemplate: []\n  resourcesRefs: []\n  resourcesRefsTemplate: []\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Updated schemas for the new frontend are collected here: ",(0,a.jsx)(t.a,{href:"https://github.com/krateoplatformops/frontend-chart/tree/0.0.19/chart/crds",children:"https://github.com/krateoplatformops/frontend-chart/tree/0.0.19/chart/crds"})]}),"\n",(0,a.jsx)(t.h2,{id:"starting-point-krateo-243-fireworksapp-compositiondefinition-1115-fireworksapp-tomigrate-composition",children:"Starting point: Krateo 2.4.3, Fireworksapp compositiondefinition 1.1.15, fireworksapp-tomigrate composition"}),"\n",(0,a.jsx)(t.p,{children:"Krateo 2.4.3 has been installed on AKS in the following way:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"helm upgrade installer installer \\\n  --repo https://charts.krateo.io \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --set krateoplatformops.service.type=LoadBalancer \\\n  --set krateoplatformops.service.externalIpAvailable=true \\\n  --install \\\n  --version 2.4.3 \\\n  --wait\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"login"})," page of Krateo 2.4.3:\n",(0,a.jsx)(t.img,{alt:"image",src:i(2128).c+"",width:"1904",height:"980"})]}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"dashboard"})," page of an empty Krateo 2.4.3 installation:\n",(0,a.jsx)(t.img,{alt:"image",src:i(1492).c+"",width:"1904",height:"980"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's apply a Fireworksapp ",(0,a.jsx)(t.code,{children:"compositiondefinition"})," version 1.1.15: ",(0,a.jsx)(t.a,{href:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp",children:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp"}),", follow instruction for Krateo version 2.4.3 or lower"]}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"dashboard"})," page of Krateo 2.4.3 installation with the installed ",(0,a.jsx)(t.code,{children:"compositiondefinition"})," with status ",(0,a.jsx)(t.code,{children:"Ready:False"}),":\n",(0,a.jsx)(t.img,{alt:"image",src:i(2648).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"dashboard"})," page of Krateo 2.4.3 installation with the install ",(0,a.jsx)(t.code,{children:"compositiondefinition"})," that, after a while,e has status ",(0,a.jsx)(t.code,{children:"Ready:True"}),":\n",(0,a.jsx)(t.img,{alt:"image",src:i(7236).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["Moving to the ",(0,a.jsx)(t.code,{children:"template"})," page of Krateo 2.4.3 installation, a Card is available:\n",(0,a.jsx)(t.img,{alt:"image",src:i(1532).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's click on the Card to open the Drawer with the CustomForm:\n",(0,a.jsx)(t.img,{alt:"image",src:i(3540).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's fill the form:\n",(0,a.jsx)(t.img,{alt:"image",src:i(6132).c+"",width:"1912",height:"979"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(5908).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["Krateo automatically opens the ",(0,a.jsx)(t.code,{children:"compositions"})," page once the ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," composition is created:\n",(0,a.jsx)(t.img,{alt:"image",src:i(7700).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's navigate the ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," composition widgets:\n",(0,a.jsx)(t.img,{alt:"image",src:i(1252).c+"",width:"1912",height:"979"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(7048).c+"",width:"1912",height:"979"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(2348).c+"",width:"1912",height:"979"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(2368).c+"",width:"1912",height:"979"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(884).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"dashboard"})," page of Krateo 2.4.3 installation with the installed ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," composition:\n",(0,a.jsx)(t.img,{alt:"image",src:i(6708).c+"",width:"1904",height:"975"})]}),"\n",(0,a.jsx)(t.h2,{id:"ending-point-krateo-250-fireworksapp-compositiondefinition-202-version-changed-within-the-same-compositiondefinition-previous-fireworksapp-tomigrate-composition",children:"Ending point: Krateo 2.5.0, Fireworksapp compositiondefinition 2.0.2 (version changed within the same compositiondefinition, previous fireworksapp-tomigrate composition"}),"\n",(0,a.jsx)(t.p,{children:"Let's upgrade Krateo from v2.4.3 to v2.5.0 on AKS in the following way:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:'cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: krateo-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm-runner\n  namespace: krateo-system\n---\n# For simplicity, cluster-admin. Tighten later if needed.\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm-runner-cluster-admin\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n  - kind: ServiceAccount\n    name: helm-runner\n    namespace: krateo-system\n---\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: krateo-pre-upgrade-2-5-0\n  namespace: krateo-system\nspec:\n  backoffLimit: 4\n  ttlSecondsAfterFinished: 3600\n  template:\n    spec:\n      serviceAccountName: helm-runner\n      restartPolicy: OnFailure\n      containers:\n        - name: runner\n          image: dtzar/helm-kubectl:3.14.4\n          imagePullPolicy: IfNotPresent\n          command: ["/bin/sh","-lc"]\n          args:\n            - |\n              set -euo pipefail\n\n              echo "Annotate/label CRD compositionreferences.resourcetrees.krateo.io..."\n              kubectl annotate crd compositionreferences.resourcetrees.krateo.io \\\n                meta.helm.sh/release-name=resource-tree-handler \\\n                meta.helm.sh/release-namespace=krateo-system \\\n                app.kubernetes.io/managed-by=Helm \\\n                --overwrite\n\n              kubectl label crd compositionreferences.resourcetrees.krateo.io \\\n                app.kubernetes.io/managed-by=Helm --overwrite\n\n              echo "Annotate secret admin-password in krateo-system..."\n              kubectl annotate secret admin-password -n krateo-system \\\n                meta.helm.sh/release-name=composable-portal-starter \\\n                meta.helm.sh/release-namespace=krateo-system \\\n                app.kubernetes.io/managed-by=Helm \\\n                --overwrite\n\n              echo "Annotate user admin in krateo-system..."\n              kubectl annotate user admin -n krateo-system \\\n                meta.helm.sh/release-name=composable-portal-starter \\\n                meta.helm.sh/release-namespace=krateo-system \\\n                app.kubernetes.io/managed-by=Helm \\\n                --overwrite\n\n              echo "Pre-upgrade 2.5.0 job done \u2705"\nEOF\n'})}),"\n",(0,a.jsx)(t.p,{children:"Update then Krateo to version 2.5.0:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"helm upgrade installer installer \\\n  --repo https://charts.krateo.io \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --set krateoplatformops.service.type=LoadBalancer \\\n  --set krateoplatformops.service.externalIpAvailable=true \\\n  --set krateoplatformops.finopsdatabasehandler.chart.version=0.4.5 \\\n  --install \\\n  --version 2.5.0 \\\n  --wait\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"login"})," page of Krateo 2.5.0:\n",(0,a.jsx)(t.img,{alt:"image",src:i(8399).c+"",width:"1912",height:"979"})]}),"\n",(0,a.jsxs)(t.p,{children:["This is the ",(0,a.jsx)(t.code,{children:"dashboard"})," page of a Krateo 2.5.0 installation:\n",(0,a.jsx)(t.img,{alt:"image",src:i(4824).c+"",width:"1904",height:"975"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's navigate the ",(0,a.jsx)(t.code,{children:"compositions"})," page of Krateo 2.5.0 - it is empty since the composition ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," has not been migrated yet:\n",(0,a.jsx)(t.img,{alt:"image",src:i(8756).c+"",width:"1904",height:"975"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's configure Krateo 2.5.0 for Fireworksapp ",(0,a.jsx)(t.code,{children:"compositiondefinition"})," version 2.0.2: ",(0,a.jsx)(t.a,{href:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp",children:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp"}),", follow instruction for Krateo == 2.5.0"]}),"\n",(0,a.jsxs)(t.p,{children:["Let's navigate again the ",(0,a.jsx)(t.code,{children:"compositions"})," page of Krateo 2.5.0 - now the composition ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," is migrated:\n",(0,a.jsx)(t.img,{alt:"image",src:i(8612).c+"",width:"1904",height:"975"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's navigate the ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," composition widgets:\n",(0,a.jsx)(t.img,{alt:"image",src:i(2784).c+"",width:"1904",height:"975"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(556).c+"",width:"1904",height:"975"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(6008).c+"",width:"1904",height:"975"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(6092).c+"",width:"1904",height:"975"}),"\n",(0,a.jsx)(t.img,{alt:"image",src:i(7396).c+"",width:"1904",height:"975"})]}),"\n",(0,a.jsxs)(t.p,{children:["The composition ",(0,a.jsx)(t.code,{children:"fireworksapp-tomigrate"})," has been migrated."]}),"\n",(0,a.jsx)(t.h1,{id:"what-has-changed-in-the-fireworksapp-helm-chart-from-1115-to-202-version",children:"What has changed in the Fireworksapp helm chart from 1.1.15 to 2.0.2 version"}),"\n",(0,a.jsx)(t.p,{children:"We have changed the dependency,"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["from: ",(0,a.jsx)(t.a,{href:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp/blob/1.1.15/chart/Chart.yaml#L27-L32",children:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp/blob/1.1.15/chart/Chart.yaml#L27-L32"})]}),"\n",(0,a.jsxs)(t.li,{children:["to: ",(0,a.jsx)(t.a,{href:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp/blob/2.0.2/chart/Chart.yaml#L20-L24",children:"https://github.com/krateoplatformops/krateo-v2-template-fireworksapp/blob/2.0.2/chart/Chart.yaml#L20-L24"})]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["We have released a new Helm Chart that collects Krateo 2.5.0 new portal widgets which is called ",(0,a.jsx)(t.code,{children:"composable-portal-starter"}),"."]})]})}function l(e={}){const{wrapper:t}={...(0,s.M)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},2128:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/01_2-4-3-login-c48a55582fa7f2cf52c8c289548a0b0c.png"},1492:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/02_2-4-3-dashboard_notemplates-f26bb31034c3b88cb8803fdc25cef8b0.png"},2648:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/03_2-4-3-dashboard_1template_readyfalse-4333319cd0985045f7af4800c66ee3b4.png"},7236:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/04_2-4-3-dashboard_1template_readytrue-b6bd1730e9afb78ddd6df6348a36e17a.png"},1532:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/05_2-4-3-templates_1template_readytrue-901dd2b9a14c1c7795a4c3addf62d079.png"},3540:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/06_2-4-3-templates_1template_form-153be93396310a9ab77a3bd451d48514.png"},6132:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/07_2-4-3-templates_1template_form_filled-fce111347171d8b5fe8ba88140502d2e.png"},5908:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/08_2-4-3-templates_1template_form_submitted-c5f8b9c55275c2a3cad0cf509d2a4190.png"},7700:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/09_2-4-3-compositions-5c666854fda2f5276d2cd241dd4b8c60.png"},1252:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/10_2-4-3-composition_overview-33f25d53c6a5ea99016e66d403ef0b2d.png"},7048:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/11_2-4-3-composition_status-ea25d926c6066f1d18fc8230a3a997fe.png"},2348:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/12_2-4-3-composition_application-d92fa4034fcc6c7bb1b4f657b31324ed.png"},2368:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/13_2-4-3-composition_events-27e5320a4e0fd62dee8a0629b819ef92.png"},884:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/14_2-4-3-composition_values-13879df667e7548399cf7df88bd5c699.png"},6708:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/15_2-4-3-dashboard_1template_1composition-f4a29d5291fe545389ee2c726dff5455.png"},8399:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/16_2-5-0-login-93a90935e234e6c7238bb09eb5fd57ec.png"},4824:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/17_2-5-0-dashboard_1template_1composition-dfc36b5b55eed3ddd0b230578242e6ff.png"},8756:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/18_2-5-0-compositions_empty-14afc0afc5bf8d5fc06c043c702aa20f.png"},8612:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/19_2-5-0-compositions-ef0ffe2af0c5c11e121357c85cf240d4.png"},2784:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/20_2-5-0-composition_overview-f81584cccf1db5750724b5e0b0a2ff5f.png"},556:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/21_2-5-0-composition_status-08d9ae37b6f688a8d1ddadc0b240c55c.png"},6008:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/22_2-5-0-composition_application-483db377abd040a5f66202b4e5439b85.png"},6092:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/23_2-5-0-composition_events-a376bd5190cad97b1b2f1d2f822b9d4a.png"},7396:(e,t,i)=>{i.d(t,{c:()=>a});const a=i.p+"assets/images/24_2-5-0-composition_values-c4dc191b63652598975eaab58f347e45.png"},2172:(e,t,i)=>{i.d(t,{I:()=>r,M:()=>n});var a=i(1504);const s={},o=a.createContext(s);function n(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);