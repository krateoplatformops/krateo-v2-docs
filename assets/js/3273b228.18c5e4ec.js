"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[454],{8268:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var r=t(7624),o=t(2172);const s={},i="eventrouter",a={id:"key-concepts/kco/eventrouter",title:"eventrouter",description:"This service serves as an active watcher of event resource in the kubernetes system, which:",source:"@site/docs/20-key-concepts/10-kco/50-eventrouter.md",sourceDirName:"20-key-concepts/10-kco",slug:"/key-concepts/kco/eventrouter",permalink:"/key-concepts/kco/eventrouter",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:50,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"provider-runtime",permalink:"/key-concepts/kco/provider-runtime"},next:{title:"eventsse",permalink:"/key-concepts/kco/eventsse"}},c={},l=[{value:"How to install",id:"how-to-install",level:2},{value:"Configuring a <em>Registration</em>",id:"configuring-a-registration",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"eventrouter",children:"eventrouter"}),"\n",(0,r.jsx)(n.p,{children:"This service serves as an active watcher of event resource in the kubernetes system, which:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["consider only events related to ",(0,r.jsx)(n.em,{children:"involvedObjects"})," with a composition identifier"]}),"\n",(0,r.jsxs)(n.li,{children:["takes those events and pushes them to a user specified ",(0,r.jsx)(n.em,{children:"HTTP hook"})," (called ",(0,r.jsx)(n.em,{children:"Registration"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The service will POST to the specified ",(0,r.jsx)(n.em,{children:"endpoint"})," a JSON containing the event info."]}),"\n",(0,r.jsx)(n.p,{children:"Here a sample event info:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "type":"Warning",\n    "reason":"CannotCreateExternalResource",\n    "deploymentId":"XXXXXXAAA1212121",\n    "time":1660835529,\n    "message":"cannot create EKS node group: ResourceInUseException: Cluster: test-1 is not in a valid state",\n    "source":"managed/nodegroup",\n    "involvedObject":{\n       "apiVersion":"eks.aws.crossplane.io/v1alpha1",\n       "kind":"NodeGroup",\n       "name":"test-1-ng",\n       "uid":"6365c158-8ee1-4d36-a33a-ba3cc0958ee0"\n    },\n    "metadata":{\n       "creationTimestamp":"2022-10-26T17:25:12+02:00",\n       "name":"test-1-ng.170c791ccd13d0cd",\n       "namespace":"default",\n       "uid":"6aa0a50b-1b5b-46e0-b5ec-a1118286f0c4"\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"how-to-install",children:"How to install"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"$ helm repo add krateo https://charts.krateo.io\n$ helm repo update krateo\n$ helm install eventrouter krateo/eventrouter --namespace krateo-system --create-namespace\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"configuring-a-registration",children:["Configuring a ",(0,r.jsx)(n.em,{children:"Registration"})]}),"\n",(0,r.jsxs)(n.p,{children:["To configure your ",(0,r.jsx)(n.em,{children:"hook"})," in order to receive events info, create and apply a manifest with ",(0,r.jsx)(n.em,{children:"Registration"})," resource:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: eventrouter.krateo.io/v1alpha1\nkind: Registration\nmetadata:\n  name: httpecho-registration\nspec:\n  # Your custom hook service name\n  serviceName: HTTP Echo\n  # Your custom hook service endpoint\n  endpoint: http://127.0.0.1:9090/handle\nEOF\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the above example the endpoint service at _ ",(0,r.jsx)(n.a,{href:"http://127.0.0.1:9090/handle",children:"http://127.0.0.1:9090/handle"}),"_ will receive the eventhandler data."]})]})}function h(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},2172:(e,n,t)=>{t.d(n,{I:()=>a,M:()=>i});var r=t(1504);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);