"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[832],{6260:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var t=i(7624),s=i(2172);const r={},c="Event SSE",l={id:"key-concepts/kco/eventsse",title:"Event SSE",description:"Streams events received from Krateo EventRouter using Server-Sent Events (SSE).",source:"@site/docs/20-key-concepts/10-kco/60-eventsse.md",sourceDirName:"20-key-concepts/10-kco",slug:"/key-concepts/kco/eventsse",permalink:"/key-concepts/kco/eventsse",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:60,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"EventRouter",permalink:"/key-concepts/kco/eventrouter"},next:{title:"krateo-frontend",permalink:"/key-concepts/kcp/frontend"}},o={},a=[{value:"Summary",id:"summary",level:2},{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"API",id:"api",level:2},{value:"Examples",id:"examples",level:2},{value:"Receiving notifications",id:"receiving-notifications",level:3},{value:"Listing last events",id:"listing-last-events",level:3},{value:"Configuration",id:"configuration",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"event-sse",children:"Event SSE"}),"\n",(0,t.jsxs)(n.p,{children:["Streams events received from ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/eventrouter",children:"Krateo EventRouter"})," using ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Server-sent_events",children:"Server-Sent Events (SSE)"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#architecture",children:"Architecture"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#api",children:"API"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#examples",children:"Examples"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#configuration",children:"Configuration"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Subscribed to the eventrouter service as event receiver."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"patches the received event adding a label that references the composition to which the event belongs"}),"\n",(0,t.jsx)(n.li,{children:"stores the event both in an internal queue and in an etcd storage"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.plantuml.com/plantuml/png/TP2nJiCm48RtUufJTuFOKLK61ZPsnE3ObzOYEGUVNGRKTyVOcCIWJea-_Vxklpj8r26cUG8w4qSHGlLoSjOIlrh_mGeB3pv52W2mQFEcZxIb-0c8ni-BvyommWuv7dsO_y3T-UxcyTkoGotL9t01x4QKGhrVqY0ckA7e7ETPepOv7Otjm7kYH91HypqyFnLLL-AMVNIZCpewprAgB6cOd9me_CkMHZLqf5Ytl9GHxSdlxIRL4ZzHL5RjMyjr1rJfEYuhRFLudosLGXwypU_RuUid9zUpjv-SQeU60x5Dy_G5",alt:"EventSSE Architcture"})}),"\n",(0,t.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,t.jsx)(n.p,{children:"This service exposes two main endpoints:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/notifications"}),", which uses SSE to send events (either all events or only those belonging to a specific composition) to the client"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/events"}),", which returns the list of all events; eventually filtered for a specific composition"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.code,{children:"/swagger/index.html"})," url for more details about all the API."]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsxs)(n.p,{children:["In the following examples ",(0,t.jsx)(n.code,{children:"$HOST"})," is the address of your eventsse instance and ",(0,t.jsx)(n.code,{children:"$PORT"})," it's listening port."]}),"\n",(0,t.jsx)(n.h3,{id:"receiving-notifications",children:"Receiving notifications"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'$ curl -v "$HOST:$PORT/notifications\n'})}),"\n",(0,t.jsx)(n.h3,{id:"listing-last-events",children:"Listing last events"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'$ curl -v "$HOST:$PORT/events\n'})}),"\n",(0,t.jsx)(n.p,{children:"By specific composition :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'$ curl -v "$HOST:$PORT/events/$COMPOSITION_ID\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["This service must be registered to the ",(0,t.jsx)(n.code,{children:"eventrouter"})," (subscription) using a manifest like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: eventrouter.krateo.io/v1alpha1\nkind: Registration\nmetadata:\n  name: eventsse\n  namespace: demo-system\nspec:\n  serviceName: Eventrouter SSE\n  endpoint: $HOST:$PORT/handle\n"})}),"\n",(0,t.jsx)(n.p,{children:"where:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"$HOST"}),": is the address of your eventsse instance (i.e. ",(0,t.jsx)(n.code,{children:"http://eventsse-internal.demo-system.svc.cluster.local"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"$PORT"}),": is the listening port of your eventsse instance"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>l,M:()=>c});var t=i(1504);const s={},r=t.createContext(s);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);