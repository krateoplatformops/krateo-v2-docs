"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[246],{8508:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>l});var s=t(7624),r=t(2172);const d={},i="snowplow",o={id:"key-concepts/kcp/snowplow",title:"snowplow",description:"Snowplow is a web service that plays a key role within the suite of components that make up Krateo PlatformOps.",source:"@site/docs/20-key-concepts/20-kcp/20-snowplow.md",sourceDirName:"20-key-concepts/20-kcp",slug:"/key-concepts/kcp/snowplow",permalink:"/key-concepts/kcp/snowplow",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"krateo-frontend",permalink:"/key-concepts/kcp/frontend"},next:{title:"backend",permalink:"/key-concepts/kcp/backend"}},c={},l=[{value:"RESTAction",id:"restaction",level:2},{value:"Overview",id:"overview",level:2},{value:"Schema <code>spec</code> Details",id:"schema-spec-details",level:2},{value:"<code>api</code> Array Item Properties",id:"api-array-item-properties",level:4},{value:"<code>dependsOn</code> Object Properties",id:"dependson-object-properties",level:4},{value:"<code>endpointRef</code> Object Properties",id:"endpointref-object-properties",level:4},{value:"<code>status</code> Properties",id:"status-properties",level:3},{value:"Examples",id:"examples",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"snowplow",children:"snowplow"}),"\n",(0,s.jsx)(n.p,{children:"Snowplow is a web service that plays a key role within the suite of components that make up Krateo PlatformOps."}),"\n",(0,s.jsx)(n.p,{children:"It serves multiple purposes, primarily acting as a bridge between Krateo's custom resources and the UI. By enabling a dynamic and declarative approach to defining UI components and layouts, Snowplow ensures that the interface is interpreted and rendered seamlessly by Krateo Frontend."}),"\n",(0,s.jsxs)(n.p,{children:["Currently, Snowplow handles on-demand resolution of the ",(0,s.jsx)(n.code,{children:"RESTAction"})," custom resource. For all other custom resources within Krateo, it delegates the task to the Kubernetes API server, which, in turn, leverages Krateo\u2019s custom aggregation API layer to process them."]}),"\n",(0,s.jsx)(n.p,{children:"Looking ahead, Snowplow will take full responsibility for managing all custom resources beyond RESTAction, eventually eliminating the need for delegation altogether."}),"\n",(0,s.jsx)(n.p,{children:"As of today, the overall architecture is structured as follows:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(2656).c+"",width:"1268",height:"1634"})}),"\n",(0,s.jsx)(n.h2,{id:"restaction",children:"RESTAction"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["This document provides an overview of the ",(0,s.jsx)(n.code,{children:"RESTAction"})," CRD and its properties to facilitate its usage within Kubernetes environments."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"RESTAction"})," Custom Resource Definition (CRD) allows users to declaratively define calls to APIs that may depend on other API calls."]}),"\n",(0,s.jsxs)(n.h2,{id:"schema-spec-details",children:["Schema ",(0,s.jsx)(n.code,{children:"spec"})," Details"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"api"})}),(0,s.jsx)(n.td,{children:"array"}),(0,s.jsx)(n.td,{children:"Defines API requests to an HTTP service."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"filter"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"A JQ filter that can be applied to the global response."})]})]})]}),"\n",(0,s.jsxs)(n.h4,{id:"api-array-item-properties",children:[(0,s.jsx)(n.code,{children:"api"})," Array Item Properties"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["A single ",(0,s.jsx)(n.code,{children:"api"})," item defines an HTTP REST call.\nThe invoked API ",(0,s.jsxs)(n.strong,{children:["must produce a ",(0,s.jsx)(n.code,{children:"JSON"})," content type"]})]}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"dependsOn"})}),(0,s.jsx)(n.td,{children:"object"}),(0,s.jsx)(n.td,{children:"Defines dependencies on other APIs."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"endpointRef"})}),(0,s.jsx)(n.td,{children:"object"}),(0,s.jsx)(n.td,{children:"References an Endpoint object."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"filter"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"A JQ expression for response processing."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"headers"})}),(0,s.jsx)(n.td,{children:"array of strings"}),(0,s.jsx)(n.td,{children:"Custom request headers (each header can be a JQ expression)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"name"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Unique identifier for the API request."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"path"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Request URI path (can be a JQ expression)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"payload"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Request body payload (can be a JQ expression)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"verb"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"HTTP method (defaults to GET if omitted)."})]})]})]}),"\n",(0,s.jsxs)(n.h4,{id:"dependson-object-properties",children:[(0,s.jsx)(n.code,{children:"dependsOn"})," Object Properties"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"iterator"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"A JQ expression that returns a JSON array on which to iterate."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"name"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Name of another API on which this depends."})]})]})]}),"\n",(0,s.jsxs)(n.h4,{id:"endpointref-object-properties",children:[(0,s.jsx)(n.code,{children:"endpointRef"})," Object Properties"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Reference to a Kubernetes secret that describes the HTTP REST API endpoint."}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"name"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Name of the referenced object."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"namespace"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Namespace of the referenced object."})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"status-properties",children:[(0,s.jsx)(n.code,{children:"status"})," Properties"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"status"})," field is an open-ended object that preserves unknown fields for storing results of all the ",(0,s.jsx)(n.code,{children:"api"})," calls."]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsxs)(n.p,{children:["Some ",(0,s.jsx)(n.code,{children:"RESTAction"})," examples can be found ",(0,s.jsx)(n.a,{href:"https://github.com/krateoplatformops/snowplow/tree/main/testdata/restactions",children:"here"}),". Lets check the one that query ",(0,s.jsx)(n.a,{href:"https://jsonplaceholder.typicode.com",children:"jsonplaceholder.typicode.com"})," API:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: Secret\ntype: Opaque\nmetadata:\n  name: typicode-endpoint\n  namespace: demo-system\nstringData:\n  server-url: https://jsonplaceholder.typicode.com\n---\napiVersion: templates.krateo.io/v1\nkind: RESTAction\nmetadata:\n  name: typicode\n  namespace: demo-system\nspec:\n  filter: "[.todos[] as $todo | .users[] | select(.id == $todo.userId) | { name: .name, id: $todo.id, title: $todo.title, completed: $todo.completed }]"\n  api:\n  - name: users\n    path: "/users"\n    endpointRef:\n      name: typicode-endpoint\n      namespace: demo-system\n    filter: map(select(.email | endswith(".biz")))\n  - name: todos\n    dependsOn: \n      name: users\n      iterator: .users\n    path: ${ "/todos?userId=" + (.id|tostring) }\n    headers:\n      - ${ "X-UserID:" + (.id|tostring) }\n    endpointRef:\n      name: typicode-endpoint\n      namespace: demo-system\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},2656:(e,n,t)=>{t.d(n,{c:()=>s});const s=t.p+"assets/images/snowplow-64bce2e8813c3df14d8e2fadf5f210d9.png"},2172:(e,n,t)=>{t.d(n,{I:()=>o,M:()=>i});var s=t(1504);const r={},d=s.createContext(r);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);