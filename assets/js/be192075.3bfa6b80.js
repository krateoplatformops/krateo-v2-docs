"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[7384],{6460:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var o=i(7624),s=i(2172);const t={},r=void 0,c={id:"key-concepts/kco/core-provider-cheatsheet",title:"core-provider-cheatsheet",description:"Comprehensive Deployment Guide with Expected Outcomes",source:"@site/docs/20-key-concepts/10-kco/11-core-provider-cheatsheet.md",sourceDirName:"20-key-concepts/10-kco",slug:"/key-concepts/kco/core-provider-cheatsheet",permalink:"/key-concepts/kco/core-provider-cheatsheet",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Krateo Core Provider",permalink:"/key-concepts/kco/core-provider"},next:{title:"composition-dynamic-controller",permalink:"/key-concepts/kco/composition-dynamic-controller"}},l={},a=[{value:"Comprehensive Deployment Guide with Expected Outcomes",id:"comprehensive-deployment-guide-with-expected-outcomes",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Initial Setup",id:"initial-setup",level:3},{value:"1. Adding Krateo Helm Repository",id:"1-adding-krateo-helm-repository",level:4},{value:"2. Updating Helm Repositories",id:"2-updating-helm-repositories",level:4},{value:"Core Platform Installation",id:"core-platform-installation",level:3},{value:"3. Installing Krateo Platform",id:"3-installing-krateo-platform",level:4},{value:"4. Verifying Platform Readiness",id:"4-verifying-platform-readiness",level:4},{value:"5. Install required providers:",id:"5-install-required-providers",level:4},{value:"CompositionDefinition Deployment",id:"compositiondefinition-deployment",level:3},{value:"1. Creating the Application Namespace",id:"1-creating-the-application-namespace",level:4},{value:"2. Deploying the CompositionDefinition",id:"2-deploying-the-compositiondefinition",level:4},{value:"3. Verifying CompositionDefinition Status",id:"3-verifying-compositiondefinition-status",level:4},{value:"Creating Compositions",id:"creating-compositions",level:3},{value:"1. Setting Up GitHub Credentials",id:"1-setting-up-github-credentials",level:4},{value:"3. Creating the GithubScaffoldingLifecycle Instance",id:"3-creating-the-githubscaffoldinglifecycle-instance",level:4},{value:"4. Monitoring Composition Progress",id:"4-monitoring-composition-progress",level:4},{value:"5. Check Helm Release Status",id:"5-check-helm-release-status",level:4},{value:"Advanced Operations",id:"advanced-operations",level:3},{value:"1. Deploying Multiple Versions",id:"1-deploying-multiple-versions",level:4},{value:"Scenario:",id:"scenario",level:5},{value:"Verifying CompositionDefinition Status",id:"verifying-compositiondefinition-status",level:5},{value:"Create a New GithubScaffoldingLifecycle Instance",id:"create-a-new-githubscaffoldinglifecycle-instance",level:5},{value:"Check Helm Release Status",id:"check-helm-release-status",level:5},{value:"2. Upgrading Compositions (massive migration)",id:"2-upgrading-compositions-massive-migration",level:4},{value:"Scenario:",id:"scenario-1",level:5},{value:"Automatic Deletion of Unused <code>composition-dynamic-controller</code> Deployments",id:"automatic-deletion-of-unused-composition-dynamic-controller-deployments",level:5},{value:"Check Helm Release Status",id:"check-helm-release-status-1",level:5},{value:"3. Upgrading Compositions with breaking changes in the <code>values.schema.json</code>",id:"3-upgrading-compositions-with-breaking-changes-in-the-valuesschemajson",level:4},{value:"Scenario:",id:"scenario-2",level:5},{value:"Step 1: Pause the Composition with the Old Version",id:"step-1-pause-the-composition-with-the-old-version",level:5},{value:"Step 2: Create a New Composition Instance with the New Version",id:"step-2-create-a-new-composition-instance-with-the-new-version",level:5},{value:"Step 3: Remove the old composition at version 0.0.1",id:"step-3-remove-the-old-composition-at-version-001",level:5},{value:"4. Upgrading a single Composition or a subset of Compositions to a new version of a CompositionDefinition",id:"4-upgrading-a-single-composition-or-a-subset-of-compositions-to-a-new-version-of-a-compositiondefinition",level:4},{value:"Scenario:",id:"scenario-3",level:5},{value:"Step 1: Setup Initial CompositionDefinition and Compositions",id:"step-1-setup-initial-compositiondefinition-and-compositions",level:5},{value:"Step 2: Apply the New Version of the CompositionDefinition",id:"step-2-apply-the-new-version-of-the-compositiondefinition",level:5},{value:"Step 3: Upgrade Specific Composition to the New Version",id:"step-3-upgrade-specific-composition-to-the-new-version",level:5},{value:"Step 4: Verify the Upgrade",id:"step-4-verify-the-upgrade",level:5},{value:"5. Pausing Composition Reconciliation",id:"5-pausing-composition-reconciliation",level:4},{value:"Use Case:",id:"use-case",level:5},{value:"Step 1: Pause Composition",id:"step-1-pause-composition",level:5},{value:"Step 2: Make Manual Changes",id:"step-2-make-manual-changes",level:5},{value:"Step 3: Resume Reconciliation",id:"step-3-resume-reconciliation",level:5},{value:"6. Pausing Composition Gracefully",id:"6-pausing-composition-gracefully",level:4},{value:"7. Safely Deleting Compositions",id:"7-safely-deleting-compositions",level:4},{value:"Troubleshooting Guide",id:"troubleshooting-guide",level:2},{value:"Common Issues and Diagnostic Procedures",id:"common-issues-and-diagnostic-procedures",level:3},{value:"1. CompositionDefinition Not Becoming Ready",id:"1-compositiondefinition-not-becoming-ready",level:4},{value:"2. Compositions Failing to Deploy",id:"2-compositions-failing-to-deploy",level:4},{value:"3. Upgrade/Rollback Failures",id:"3-upgraderollback-failures",level:4},{value:"4a. Certificate Issues: Webhook Failure - Valid ONLY for versions of core-provider after 0.24.2",id:"4a-certificate-issues-webhook-failure---valid-only-for-versions-of-core-provider-after-0242",level:4},{value:"4b. Certificate Issues: Mutating Webhook Configuration - Valid ONLY for versions of core-provider before 0.24.2",id:"4b-certificate-issues-mutating-webhook-configuration---valid-only-for-versions-of-core-provider-before-0242",level:4},{value:"4.1 Certificate Issues: Conversion Webhook Configuration",id:"41-certificate-issues-conversion-webhook-configuration",level:4},{value:"5. Error after creating CompositionDefinition",id:"5-error-after-creating-compositiondefinition",level:4},{value:"General Diagnostic Tools",id:"general-diagnostic-tools",level:3},{value:"Common Solutions",id:"common-solutions",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"comprehensive-deployment-guide-with-expected-outcomes",children:"Comprehensive Deployment Guide with Expected Outcomes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#comprehensive-deployment-guide-with-expected-outcomes",children:"Comprehensive Deployment Guide with Expected Outcomes"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#introduction",children:"Introduction"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#initial-setup",children:"Initial Setup"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#core-platform-installation",children:"Core Platform Installation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#compositiondefinition-deployment",children:"CompositionDefinition Deployment"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#creating-compositions",children:"Creating Compositions"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#advanced-operations",children:"Advanced Operations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#1-deploying-multiple-versions",children:"1. Deploying Multiple Versions"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#2-upgrading-compositions-massive-migration",children:"2. Upgrading Compositions (massive migration)"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsxs)(n.a,{href:"#3-upgrading-compositions-with-breaking-changes-in-the-valuesschemajson",children:["3. Upgrading Compositions with breaking changes in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})]})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#4-upgrading-a-single-composition-or-a-subset-of-compositions-to-a-new-version-of-a-compositiondefinition",children:"4. Upgrading a single Composition or a subset of Compositions to a new version of a CompositionDefinition"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#5-pausing-composition-reconciliation",children:"5. Pausing Composition Reconciliation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#6-pausing-composition-gracefully",children:"6. Pausing Composition Gracefully"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#7-safely-deleting-compositions",children:"7. Safely Deleting Compositions"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#troubleshooting-guide",children:"Troubleshooting Guide"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#common-issues-and-diagnostic-procedures",children:"Common Issues and Diagnostic Procedures"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#1-compositiondefinition-not-becoming-ready",children:"1. CompositionDefinition Not Becoming Ready"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#2-compositions-failing-to-deploy",children:"2. Compositions Failing to Deploy"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#3-upgraderollback-failures",children:"3. Upgrade/Rollback Failures"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#4a-certificate-issues-webhook-failure---valid-only-for-versions-of-core-provider-after-0242",children:"4a. Certificate Issues: Webhook Failure - Valid ONLY for versions of core-provider after <0.24.2>"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#4b-certificate-issues-mutating-webhook-configuration---valid-only-for-versions-of-core-provider-before-0242",children:"4b. Certificate Issues: Mutating Webhook Configuration - Valid ONLY for versions of core-provider before <0.24.2>"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#41-certificate-issues-conversion-webhook-configuration",children:"4.1 Certificate Issues: Conversion Webhook Configuration"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#5-error-after-creating-compositiondefinition",children:"5. Error after creating CompositionDefinition"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#general-diagnostic-tools",children:"General Diagnostic Tools"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#common-solutions",children:"Common Solutions"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"The Krateo V2 Template Fireworks App provides a complete solution for deploying and managing the GithubScaffoldingLifecycle Blueprint on Kubernetes using Krateo's Composition system. This guide covers the entire lifecycle from initial deployment to advanced management scenarios."}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(n.p,{children:"Before beginning, ensure you have:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A Kubernetes cluster (v1.30+ recommended)"}),"\n",(0,o.jsx)(n.li,{children:"Helm installed (v3.0+)"}),"\n",(0,o.jsx)(n.li,{children:"kubectl configured to access your cluster"}),"\n",(0,o.jsx)(n.li,{children:"A GitHub account with repository creation permissions"}),"\n",(0,o.jsx)(n.li,{children:"A GitHub personal access token with repo scope"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,o.jsx)(n.h4,{id:"1-adding-krateo-helm-repository",children:"1. Adding Krateo Helm Repository"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm repo add krateo https://charts.krateo.io\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Expect:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The command will register Krateo's chart repository with your local Helm installation"}),"\n",(0,o.jsx)(n.li,{children:'Upon success, you\'ll see confirmation that "krateo" was added to your repositories'}),"\n",(0,o.jsxs)(n.li,{children:["This enables you to install Krateo charts using the ",(0,o.jsx)(n.code,{children:"krateo/"})," prefix"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-updating-helm-repositories",children:"2. Updating Helm Repositories"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm repo update krateo\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What's Happening:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Helm contacts the repository URL to fetch the latest chart information"}),"\n",(0,o.jsx)(n.li,{children:"It updates the local cache of available charts and versions"}),"\n",(0,o.jsx)(n.li,{children:"The success message indicates you now have access to the most recent charts"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"core-platform-installation",children:"Core Platform Installation"}),"\n",(0,o.jsx)(n.h4,{id:"3-installing-krateo-platform",children:"3. Installing Krateo Platform"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm upgrade installer-crd installer-crd \\\n  --repo https://charts.krateo.io \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --install \\\n  --version 2.7.0 \\\n  --wait\n\nhelm upgrade installer installer \\\n  --repo https://charts.krateo.io \\\n  --namespace krateo-system \\\n  --create-namespace \\\n  --install \\\n  --version 2.7.0 \\\n  --wait\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Behavior:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Helm will create the ",(0,o.jsx)(n.code,{children:"krateo-system"})," namespace if it doesn't exist"]}),"\n",(0,o.jsx)(n.li,{children:"The installer chart (version 2.7.0) will be deployed"}),"\n",(0,o.jsx)(n.li,{children:"The --wait flag ensures command completes only when resources are ready"}),"\n",(0,o.jsx)(n.li,{children:"Output shows deployment status and namespace information"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"4-verifying-platform-readiness",children:"4. Verifying Platform Readiness"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl wait krateoplatformops krateo --for condition=Ready=True --namespace krateo-system --timeout=660s\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What This Does:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'Polls the Krateo platform status until "Ready" condition is True'}),"\n",(0,o.jsx)(n.li,{children:"Times out after 660 seconds if not ready"}),"\n",(0,o.jsx)(n.li,{children:"Successful output means core components are operational"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"5-install-required-providers",children:"5. Install required providers:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm repo add marketplace https://marketplace.krateo.io\nhelm repo update marketplace\nhelm install github-provider-kog-repo marketplace/github-provider-kog-repo --namespace krateo-system --create-namespace --wait --version 1.0.0\nhelm install git-provider krateo/git-provider --namespace krateo-system --create-namespace --wait --version 0.10.1\nhelm repo add argo https://argoproj.github.io/argo-helm\nhelm repo update argo\nhelm install argocd argo/argo-cd --namespace krateo-system --create-namespace --wait --version 8.0.17\n"})}),"\n",(0,o.jsx)(n.p,{children:"These installations set up the necessary providers for GitHub and ArgoCD, enabling integration with your deployment process of the applation."}),"\n",(0,o.jsx)(n.h3,{id:"compositiondefinition-deployment",children:"CompositionDefinition Deployment"}),"\n",(0,o.jsx)(n.h4,{id:"1-creating-the-application-namespace",children:"1. Creating the Application Namespace"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Outcome:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Creates a dedicated namespace for your Fireworks App resources"}),"\n",(0,o.jsx)(n.li,{children:"Isolates your application resources from other deployments"}),"\n",(0,o.jsx)(n.li,{children:"Simple confirmation message shows creation success"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-deploying-the-compositiondefinition",children:"2. Deploying the CompositionDefinition"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: lifecycleapp-cd-v1\n  namespace: cheatsheet-system\nspec:\n  chart:\n    repo: github-scaffolding-lifecycle\n    url: https://marketplace.krateo.io\n    version: 0.0.1\nEOF\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What Happens Next:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Krateo processes the definition and generates a Custom Resource Definition (CRD)"}),"\n",(0,o.jsx)(n.li,{children:"A dedicated controller pod is deployed to manage compositions"}),"\n",(0,o.jsx)(n.li,{children:"The system prepares to accept GithubScaffoldingLifecycle custom resources"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"3-verifying-compositiondefinition-status",children:"3. Verifying CompositionDefinition Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl wait compositiondefinition lifecycleapp-cd-v1 --for condition=Ready=True --namespace cheatsheet-system --timeout=600s\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"System Behavior:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Command waits until the CompositionDefinition is fully processed"}),"\n",(0,o.jsx)(n.li,{children:"During this time, Krateo is setting up the necessary controllers"}),"\n",(0,o.jsx)(n.li,{children:"Success means you can now create GithubScaffoldingLifecycle instances"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"creating-compositions",children:"Creating Compositions"}),"\n",(0,o.jsx)(n.h4,{id:"1-setting-up-github-credentials",children:"1. Setting Up GitHub Credentials"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic github-repo-creds \\\n  --namespace krateo-system \\\n  --from-literal=token=YOUR_GITHUB_TOKEN\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Why This Matters:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Stores your GitHub token securely in the cluster"}),"\n",(0,o.jsx)(n.li,{children:"Enables the system to interact with your repositories"}),"\n",(0,o.jsx)(n.li,{children:"The secret will be referenced by compositions for Git operations"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"3-creating-the-githubscaffoldinglifecycle-instance",children:"3. Creating the GithubScaffoldingLifecycle Instance"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v0-0-1\nkind: GithubScaffoldingLifecycle\nmetadata:\n  name: lifecycle-composition-1\n  namespace: cheatsheet-system\nspec:\n  argocd:\n    namespace: krateo-system\n    application:\n      project: default\n      source:\n        path: chart/\n      destination:\n        server: https://kubernetes.default.svc\n        namespace: githubscaffolding-app\n      syncEnabled: false\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n  app:\n    service:\n      type: NodePort\n      port: 31180\n  git:\n    unsupportedCapabilities: true\n    insecure: true\n    fromRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-blueprints\n      name: github-scaffolding-lifecycle\n      branch: main\n      path: skeleton/\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n    toRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-test # Replace with your GitHub organization\n      name: lifecycleapp-test-1 # You can customize the repository name\n      branch: main\n      path: /\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n      private: false\n      initialize: true\n      deletionPolicy: Delete\n      verbose: false\n      configurationRef:\n        name: repo-config\n        namespace: demo-system\nEOF\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What Occurs:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Krateo creates a new GithubScaffoldingLifecycle resource"}),"\n",(0,o.jsx)(n.li,{children:"The controller begins provisioning the application"}),"\n",(0,o.jsx)(n.li,{children:"ArgoCD is configured to manage the deployment"}),"\n",(0,o.jsx)(n.li,{children:"A new GitHub repository is created (if specified)"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"4-monitoring-composition-progress",children:"4. Monitoring Composition Progress"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl wait githubscaffoldinglifecycles lifecycle-composition-1 \\\n  --for condition=Ready=True \\\n  --timeout=300s \\\n  --namespace cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Workflow:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Command waits until all resources are provisioned"}),"\n",(0,o.jsx)(n.li,{children:"During this time, containers are pulled and started"}),"\n",(0,o.jsx)(n.li,{children:"Services are created and become accessible"}),"\n",(0,o.jsx)(n.li,{children:"Success means your application is fully deployed"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"5-check-helm-release-status",children:"5. Check Helm Release Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm list -n cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Expect:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Helm lists all releases in the ",(0,o.jsx)(n.code,{children:"cheatsheet-system"})," namespace"]}),"\n",(0,o.jsxs)(n.li,{children:["You should see the ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1-<[:8]UUID>"})," release with version 0.0.1"]}),"\n",(0,o.jsx)(n.li,{children:"This confirms that the Helm chart was successfully deployed"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"advanced-operations",children:"Advanced Operations"}),"\n",(0,o.jsx)(n.h4,{id:"1-deploying-multiple-versions",children:"1. Deploying Multiple Versions"}),"\n",(0,o.jsx)(n.h5,{id:"scenario",children:"Scenario:"}),"\n",(0,o.jsx)(n.p,{children:"You need to run two different versions of the same application simultaneously for testing purposes."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: lifecycleapp-cd-v2\n  namespace: cheatsheet-system\nspec:\n  chart:\n    repo: github-scaffolding-lifecycle\n    url: https://marketplace.krateo.io\n    version: 0.0.2\nEOF\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"System Response:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A second controller is deployed for the new version"}),"\n",(0,o.jsx)(n.li,{children:"Both versions can operate simultaneously"}),"\n",(0,o.jsx)(n.li,{children:"Each version maintains its own CRD and controller"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This will create a new ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," named ",(0,o.jsx)(n.code,{children:"lifecycleapp-cd-v2"})," in the ",(0,o.jsx)(n.code,{children:"cheatsheet-system"})," namespace, which will manage resources of version 0.0.2 of the lifecycleapp chart.\nYou can then deploy the new version of the chart by applying the ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," manifest. The ",(0,o.jsx)(n.code,{children:"core-provider"})," will add a new version to the existing CRD ",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles.composition.krateo.io"})," and deploy a new instance of the ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," to manage resources of version 0.0.2.\nThe ",(0,o.jsx)(n.code,{children:"core-provider"})," will leave the previous version of the chart (0.0.1) running along with its associated ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," instance. This allows you to run multiple versions of the same application simultaneously, each managed by its own ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"}),"."]}),"\n",(0,o.jsx)(n.h5,{id:"verifying-compositiondefinition-status",children:"Verifying CompositionDefinition Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl wait compositiondefinition lifecycleapp-cd-v2 --for condition=Ready=True --namespace cheatsheet-system --timeout=600s\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"System Behavior:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Command waits until the CompositionDefinition is fully processed"}),"\n",(0,o.jsx)(n.li,{children:"During this time, Krateo is setting up the necessary controllers"}),"\n",(0,o.jsx)(n.li,{children:"Success means you can now create GithubScaffoldingLifecycle instances"}),"\n"]}),"\n",(0,o.jsx)(n.h5,{id:"create-a-new-githubscaffoldinglifecycle-instance",children:"Create a New GithubScaffoldingLifecycle Instance"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v0-0-2\nkind: GithubScaffoldingLifecycle\nmetadata:\n  name: lifecycle-composition-2\n  namespace: cheatsheet-system\nspec:\n  argocd:\n    namespace: krateo-system\n    application:\n      project: default\n      source:\n        path: chart/\n      destination:\n        server: https://kubernetes.default.svc\n        namespace: githubscaffolding-app\n      syncEnabled: false\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n  app:\n    service:\n      type: NodePort\n      port: 31180\n  git:\n    unsupportedCapabilities: true\n    insecure: true\n    fromRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-blueprints\n      name: github-scaffolding-lifecycle\n      branch: main\n      path: skeleton/\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n    toRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-test # Replace with your GitHub organization\n      name: lifecycleapp-test-2 # You can customize the repository name\n      branch: main\n      path: /\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n      private: false\n      initialize: true\n      deletionPolicy: Delete\n      verbose: false\n      configurationRef:\n        name: repo-config\n        namespace: demo-system\nEOF\n"})}),"\n",(0,o.jsx)(n.h5,{id:"check-helm-release-status",children:"Check Helm Release Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm list -n cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Expect:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You should see both ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1"})," and ",(0,o.jsx)(n.code,{children:"lifecycle-composition-2"})]}),"\n",(0,o.jsx)(n.li,{children:"Each release corresponds to its respective version"}),"\n",(0,o.jsx)(n.li,{children:"This confirms that both versions are deployed and managed independently"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-upgrading-compositions-massive-migration",children:"2. Upgrading Compositions (massive migration)"}),"\n",(0,o.jsx)(n.h5,{id:"scenario-1",children:"Scenario:"}),"\n",(0,o.jsxs)(n.p,{children:["You need to upgrade the existing version of the application to a newer version (0.0.2). To be sure the new version can be deployed, the ",(0,o.jsx)(n.code,{children:"values.schema.json"})," should not add any new required fields or remove any existing required fields. If you need to add new required fields, you should create a new ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," with the new version of the chart. Refer to ",(0,o.jsx)(n.a,{href:"#3-upgrading-compositions-with-changes-in-the-valuesschemajson",children:"the next section"})," for more details."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'kubectl patch compositiondefinition lifecycleapp-cd-v1 \\\n  -n cheatsheet-system \\\n  --type=merge \\\n  -p \'{"spec":{"chart":{"version":"0.0.2"}}}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Upgrade Process:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The controller gradually reconciles existing resources"}),"\n",(0,o.jsx)(n.li,{children:"New pods are rolled out using the updated version"}),"\n",(0,o.jsx)(n.li,{children:"The system ensures zero-downtime during transition"}),"\n",(0,o.jsx)(n.li,{children:"All components eventually reflect the new version"}),"\n",(0,o.jsx)(n.li,{children:"The old version is marked for cleanup"}),"\n"]}),"\n",(0,o.jsxs)(n.h5,{id:"automatic-deletion-of-unused-composition-dynamic-controller-deployments",children:["Automatic Deletion of Unused ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," Deployments"]}),"\n",(0,o.jsxs)(n.p,{children:["Notice that the previously deployed instances (pods) of ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," that were configured to manage resources of version 1.1.14 no longer exist in the cluster."]}),"\n",(0,o.jsx)(n.p,{children:"This is due to the automatic cleanup mechanism that removes older and unused deployments along with their associated RBAC resources from the cluster:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get po -n cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:"This automatic cleanup helps maintain cluster cleaniness by removing outdated controller instances when they are no longer needed."}),"\n",(0,o.jsx)(n.h5,{id:"check-helm-release-status-1",children:"Check Helm Release Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm list -n cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Expect:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You should see both ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1"})," and ",(0,o.jsx)(n.code,{children:"lifecycle-composition-2"})," listed"]}),"\n",(0,o.jsxs)(n.li,{children:["Each release corresponds to its respective version but now ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1"})," will be updated to version 0.0.2"]}),"\n"]}),"\n",(0,o.jsxs)(n.h4,{id:"3-upgrading-compositions-with-breaking-changes-in-the-valuesschemajson",children:["3. Upgrading Compositions with breaking changes in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})]}),"\n",(0,o.jsx)(n.h5,{id:"scenario-2",children:"Scenario:"}),"\n",(0,o.jsxs)(n.p,{children:["This can be useful for upgrading a chart where you have changed the ",(0,o.jsx)(n.code,{children:"values.schema.json"})," and you want to ensure that the new version can be deployed without issues."]}),"\n",(0,o.jsx)(n.p,{children:"About breaking changes in a new version of a chart:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Adding new required fields in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})]}),"\n",(0,o.jsxs)(n.li,{children:["Removing existing required fields in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})]}),"\n",(0,o.jsxs)(n.li,{children:["Changing the type of existing fields in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})]}),"\n",(0,o.jsxs)(n.li,{children:["Modifying the structure of the ",(0,o.jsx)(n.code,{children:"values.schema.json"})," in a way that is not backward compatible"]}),"\n",(0,o.jsx)(n.li,{children:"Introducing new dependencies that are not compatible with the previous version"}),"\n",(0,o.jsx)(n.li,{children:"Altering validation rules that could reject previously valid configurations"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Suppose you have installed composition ",(0,o.jsx)(n.code,{children:"lifecycleapp-cd-v1"})," with version 0.0.1 and you want to upgrade it to version 0.0.2, but the new version has changes in the ",(0,o.jsx)(n.code,{children:"values.schema.json"})," that require you to create a new ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," with the new version of the chart."]}),"\n",(0,o.jsxs)(n.p,{children:["The first step is to create a new ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," with the new version of the chart. You can do this by applying the following manifest as done in ",(0,o.jsx)(n.a,{href:"#1-deploying-multiple-versions",children:"the previous section"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: lifecycleapp-cd-v2\n  namespace: lifecycleapp-system\nspec:\n  chart:\n    repo: github-scaffolding-lifecycle\n    url: https://marketplace.krateo.io\n    version: 0.0.2\nEOF\n"})}),"\n",(0,o.jsxs)(n.p,{children:["At this point, you have two ",(0,o.jsx)(n.code,{children:"CompositionDefinition"})," resources in the cluster: ",(0,o.jsx)(n.code,{children:"lifecycleapp-cd-v1"})," with version 0.0.1 and ",(0,o.jsx)(n.code,{children:"lifecycleapp-cd-v2"})," with version 0.0.2."]}),"\n",(0,o.jsx)(n.p,{children:"At this point, suppose you need to upgrade an existing release of a composition to the new version. You can do this by following the steps below:"}),"\n",(0,o.jsx)(n.h5,{id:"step-1-pause-the-composition-with-the-old-version",children:"Step 1: Pause the Composition with the Old Version"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'kubectl annotate githubscaffoldinglifecycles lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  "krateo.io/paused=true"\n'})}),"\n",(0,o.jsx)(n.p,{children:"This ensures that the old version of the composition is not reconciled while you are upgrading to the new version."}),"\n",(0,o.jsx)(n.h5,{id:"step-2-create-a-new-composition-instance-with-the-new-version",children:"Step 2: Create a New Composition Instance with the New Version"}),"\n",(0,o.jsxs)(n.p,{children:["Create a new GithubScaffoldingLifecycle instance with the new version of the chart. Note that you need to add a label called ",(0,o.jsx)(n.code,{children:"krateo.io/release-name"})," to the new GithubScaffoldingLifecycle instance. This label is used by the ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," to identify the release name of the composition. The value of this label should be the same as the name of the old GithubScaffoldingLifecycle instance. In the following example, the value of the label is ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1"}),", which is the name of the release installed at ",(0,o.jsx)(n.a,{href:"#3-creating-the-githubscaffoldinglifecycle-instance",children:"step 1"}),". Normally, this label is automatically added to the GithubScaffoldingLifecycle instance when it is created. However, in this case, you need to add it manually because you are creating a new GithubScaffoldingLifecycle instance with a different name."]}),"\n",(0,o.jsxs)(n.p,{children:["The manifest below shows how to create a new GithubScaffoldingLifecycle instance with the new version of the chart, with the values that follows the new ",(0,o.jsx)(n.code,{children:"values.schema.json"})," with breaking changes.\nYou can do that by applying the following manifest:"]}),"\n",(0,o.jsx)(n.p,{children:"As a first step, you need to get the release name of the old composition. You can do that by running the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get githubscaffoldinglifecycles lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  -o jsonpath='{.metadata.labels.krateo\\.io/release-name}'\n"})}),"\n",(0,o.jsx)(n.p,{children:"Then, you can use the release name in the manifest below."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v0-0-2\nkind: GithubScaffoldingLifecycle\nmetadata:\n  name: lifecycle-composition-2\n  namespace: cheatsheet-system\n  labels:\n    krateo.io/release-name: <RELEASE_NAME_FROM_OLD_COMPOSITION>\nspec:\n  argocd:\n    namespace: krateo-system\n    application:\n      project: default\n      source:\n        path: chart/\n      destination:\n        server: https://kubernetes.default.svc\n        namespace: githubscaffolding-app\n      syncEnabled: false\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n  app:\n    service:\n      type: NodePort\n      port: 31180\n  git:\n    unsupportedCapabilities: true\n    insecure: true\n    fromRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-blueprints\n      name: github-scaffolding-lifecycle\n      branch: main\n      path: skeleton/\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n    toRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-test # Replace with your GitHub organization\n      name: lifecycleapp-test-2 # You can customize the repository name\n      branch: main\n      path: /\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n      private: false\n      initialize: true\n      deletionPolicy: Delete\n      verbose: false\n      configurationRef:\n        name: repo-config\n        namespace: demo-system\nEOF\n"})}),"\n",(0,o.jsxs)(n.p,{children:["At this point, the helm release ",(0,o.jsx)(n.code,{children:"lifecycle-composition-1"}),"  will be upgraded to version 0.0.2."]}),"\n",(0,o.jsx)(n.h5,{id:"step-3-remove-the-old-composition-at-version-001",children:"Step 3: Remove the old composition at version 0.0.1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl delete githubscaffoldinglifecycle lifecycle-composition-1 \\\n  -n cheatsheet-system\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You also need to append the annotation ",(0,o.jsx)(n.code,{children:"krateo.io/management-policy=orphan"})," to the new composition to prevent the deletion of the helm release when the old composition is deleted. You can do this by applying the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl annotate githubscaffoldinglifecycle lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  krateo.io/management-policy=orphan\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You also need to remove the finalizer in the old composition because the annotation ",(0,o.jsx)(n.code,{children:"krateo.io/paused=true"})," will prevent the old composition from being deleted. You can do this by applying the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'kubectl patch githubscaffoldinglifecycle lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  --type=merge \\\n  -p \'{"metadata":{"finalizers":null}}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:"At this point, the old composition will be deleted and the new composition will be upgraded to version 1.1.14."}),"\n",(0,o.jsx)(n.h4,{id:"4-upgrading-a-single-composition-or-a-subset-of-compositions-to-a-new-version-of-a-compositiondefinition",children:"4. Upgrading a single Composition or a subset of Compositions to a new version of a CompositionDefinition"}),"\n",(0,o.jsx)(n.h5,{id:"scenario-3",children:"Scenario:"}),"\n",(0,o.jsx)(n.p,{children:"This can be useful when you want to upgrade only specific Compositions after a new version of a CompositionDefinition is released, while keeping other Compositions on the previous version. This allows for a gradual migration and testing of the new version without impacting all existing Compositions at once."}),"\n",(0,o.jsxs)(n.p,{children:["Suppose you have installed the CompositionDefinition ",(0,o.jsx)(n.code,{children:"lifecycleapp-cd-v1"})," with version 0.0.1 (from ",(0,o.jsx)(n.a,{href:"#2-deploying-the-compositiondefinition",children:"the previous step"}),"), you have already created some Compositions based on it, and now you want to upgrade only some of these Compositions to version 0.0.2 of the CompositionDefinition.\nNote that the version 0.0.2 of the CompositionDefinition introduces an additional field ",(0,o.jsx)(n.code,{children:"description"})," at path ",(0,o.jsx)(n.code,{children:"git.toRepo.description"}),", with a default value."]}),"\n",(0,o.jsx)(n.h5,{id:"step-1-setup-initial-compositiondefinition-and-compositions",children:"Step 1: Setup Initial CompositionDefinition and Compositions"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's create two Compositions based on this CompositionDefinition:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v0-0-1\nkind: GithubScaffoldingLifecycle\nmetadata:\n  name: composition-1\n  namespace: cheatsheet-system\nspec:\n  argocd:\n    namespace: krateo-system\n    application:\n      project: default\n      source:\n        path: chart/\n      destination:\n        server: https://kubernetes.default.svc\n        namespace: githubscaffolding-app\n      syncEnabled: false\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n  app:\n    service:\n      type: NodePort\n      port: 31180\n  git:\n    unsupportedCapabilities: true\n    insecure: true\n    fromRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-blueprints\n      name: github-scaffolding-lifecycle\n      branch: main\n      path: skeleton/\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n    toRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-test\n      name: postdemoday-1\n      branch: main\n      path: /\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n      private: false\n      initialize: true\n      deletionPolicy: Delete\n      verbose: false\n      configurationRef:\n        name: repo-config\n        namespace: demo-system\nEOF\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: composition.krateo.io/v0-0-1\nkind: GithubScaffoldingLifecycle\nmetadata:\n  name: composition-2\n  namespace: cheatsheet-system\nspec:\n  argocd:\n    namespace: krateo-system\n    application:\n      project: default\n      source:\n        path: chart/\n      destination:\n        server: https://kubernetes.default.svc\n        namespace: githubscaffolding-app\n      syncEnabled: false\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n  app:\n    service:\n      type: NodePort\n      port: 31180\n  git:\n    unsupportedCapabilities: true\n    insecure: true\n    fromRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-blueprints\n      name: github-scaffolding-lifecycle\n      branch: main\n      path: skeleton/\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n    toRepo:\n      scmUrl: https://github.com\n      org: krateoplatformops-test\n      name: postdemoday-1\n      branch: main\n      path: /\n      credentials:\n        authMethod: generic\n        secretRef:\n          namespace: krateo-system\n          name: github-repo-creds\n          key: token\n      private: false\n      initialize: true\n      deletionPolicy: Delete\n      verbose: false\n      configurationRef:\n        name: repo-config\n        namespace: demo-system\nEOF\n"})}),"\n",(0,o.jsxs)(n.p,{children:["At this point, both ",(0,o.jsx)(n.code,{children:"composition-1"})," and ",(0,o.jsx)(n.code,{children:"composition-2"})," are based on version 0.0.1 of the CompositionDefinition and are managed by the same CDC (",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles-v0-0-1-controller"}),")."]}),"\n",(0,o.jsx)(n.h5,{id:"step-2-apply-the-new-version-of-the-compositiondefinition",children:"Step 2: Apply the New Version of the CompositionDefinition"}),"\n",(0,o.jsx)(n.p,{children:"Now, let's apply the new version 0.0.2 of the CompositionDefinition:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"cat <<EOF | kubectl apply -f -\napiVersion: core.krateo.io/v1alpha1\nkind: CompositionDefinition\nmetadata:\n  name: lifecycleapp-cd-v2\n  namespace: cheatsheet-system\nspec:\n  chart:\n    repo: github-scaffolding-lifecycle\n    url: https://marketplace.krateo.io\n    version: 0.0.2\nEOF\n"})}),"\n",(0,o.jsx)(n.h5,{id:"step-3-upgrade-specific-composition-to-the-new-version",children:"Step 3: Upgrade Specific Composition to the New Version"}),"\n",(0,o.jsxs)(n.p,{children:["In order to upgrade only ",(0,o.jsx)(n.code,{children:"composition-2"})," to version 0.0.2 of the CompositionDefinition, we need to update 2 labels on the ",(0,o.jsx)(n.code,{children:"composition-2"})," resource."]}),"\n",(0,o.jsx)(n.p,{children:"From:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"krateo.io/composition-definition-name: github-scaffolding-lifecycle-v1\nkrateo.io/composition-version: v0-0-1\n"})}),"\n",(0,o.jsx)(n.p,{children:"To:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"krateo.io/composition-definition-name: github-scaffolding-lifecycle-v2\nkrateo.io/composition-version: v0-0-2\n"})}),"\n",(0,o.jsx)(n.p,{children:"The other labels should remain unchanged."}),"\n",(0,o.jsx)(n.h5,{id:"step-4-verify-the-upgrade",children:"Step 4: Verify the Upgrade"}),"\n",(0,o.jsxs)(n.p,{children:["At this point, the CDC ",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles-v0-0-2-controller"})," will take over the management of ",(0,o.jsx)(n.code,{children:"composition-2"})," while ",(0,o.jsx)(n.code,{children:"composition-1"})," will still be managed by the previous CDC ",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles-v0-0-1-controller"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To check whether the upgrade was successful, you can check the newly added default field ",(0,o.jsx)(n.code,{children:"description"})," in the ",(0,o.jsx)(n.code,{children:"toRepo"})," section of ",(0,o.jsx)(n.code,{children:"composition-2"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"kubectl get githubscaffoldinglifecycles.v0-0-2.composition.krateo.io composition-2 -o yaml\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Note that checking the version v0-0-1 of ",(0,o.jsx)(n.code,{children:"composition-2"})," will not show the new ",(0,o.jsx)(n.code,{children:"description"})," field."]}),"\n",(0,o.jsxs)(n.p,{children:["Additionally, checking the logs of both CDCs will show that ",(0,o.jsx)(n.code,{children:"composition-2"})," is being reconciled by the new CDC\n(",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles-v0-0-2-controller"}),") while ",(0,o.jsx)(n.code,{children:"composition-1"})," continues to be reconciled by the old CDC (",(0,o.jsx)(n.code,{children:"githubscaffoldinglifecycles-v0-0-1-controller"}),")."]}),"\n",(0,o.jsx)(n.h4,{id:"5-pausing-composition-reconciliation",children:"5. Pausing Composition Reconciliation"}),"\n",(0,o.jsx)(n.h5,{id:"use-case",children:"Use Case:"}),"\n",(0,o.jsx)(n.p,{children:"Temporarily stop automatic reconciliation during maintenance or troubleshooting."}),"\n",(0,o.jsx)(n.h5,{id:"step-1-pause-composition",children:"Step 1: Pause Composition"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'kubectl annotate githubscaffoldinglifecycles lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  "krateo.io/paused=true"\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Result:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Composition is annotated with ",(0,o.jsx)(n.code,{children:"krateo.io/paused=true"})]}),"\n",(0,o.jsx)(n.li,{children:"Controller stops reconciling this instance"}),"\n",(0,o.jsxs)(n.li,{children:["Verify with:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get githubscaffoldinglifecycles lifecycle-composition-1 -n cheatsheet-system -o jsonpath='{.metadata.annotations}'\n"})}),"\n","You could also check events:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get events -n cheatsheet-system --sort-by='.metadata.creationTimestamp' | grep \"lifecycle-composition-1\"\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h5,{id:"step-2-make-manual-changes",children:"Step 2: Make Manual Changes"}),"\n",(0,o.jsx)(n.p,{children:"During paused state, you can:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Manually modify resources"}),"\n",(0,o.jsx)(n.li,{children:"Troubleshoot issues"}),"\n",(0,o.jsx)(n.li,{children:"Perform maintenance"}),"\n"]}),"\n",(0,o.jsx)(n.h5,{id:"step-3-resume-reconciliation",children:"Step 3: Resume Reconciliation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'kubectl annotate githubscaffoldinglifecycles lifecycle-composition-1 \\\n  -n cheatsheet-system \\\n  "krateo.io/paused-"\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Result:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pause annotation is removed"}),"\n",(0,o.jsx)(n.li,{children:"Controller resumes normal operation"}),"\n",(0,o.jsx)(n.li,{children:"Changes are reconciled according to desired state"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"6-pausing-composition-gracefully",children:"6. Pausing Composition Gracefully"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," 0.19.3 and later (released with ",(0,o.jsx)(n.code,{children:"core-provider-chart"})," 0.33.4) supports a graceful pause mechanism that ensures any resource managed by the composition will be paused ",(0,o.jsx)(n.em,{children:"before"})," the composition reconciliation is paused. This means the resources managed by the composition will not be reconciled until the composition is resumed."]}),"\n",(0,o.jsxs)(n.p,{children:["To support this feature, you need to follow the steps described in the ",(0,o.jsxs)(n.a,{href:"https://github.com/krateoplatformops/composition-dynamic-controller?tab=readme-ov-file#about-the-gracefullypaused-value",children:[(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," documentation"]}),". Please note that this feature is not supported for compositions created with versions of ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," earlier than 0.19.3, and you will need to modify your chart according to the documentation linked above."]}),"\n",(0,o.jsx)(n.h4,{id:"7-safely-deleting-compositions",children:"7. Safely Deleting Compositions"}),"\n",(0,o.jsx)(n.p,{children:"You can safely delete all compositions and their associated resources using the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl delete compositiondefinition lifecycleapp-cd-v1 \\\n  -n cheatsheet-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Expected Outcome:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"deletionTimestamp"})," is set in the generated CRD and in all the compositions related to this CRD."]}),"\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"compositiondefinition"})," and all associated resources are deleted. (It may take a few minutes because any release associated with the composition will be deleted first.)"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Note: If some compositions are stuck in the deletion process, do not enforce their deletion by removing the finalizer in the CRD. Instead, you should check the logs of the ",(0,o.jsx)(n.code,{children:"composition-dynamic-controller"})," to understand why the deletion is stuck. If you need to force the deletion, you can do so by removing the finalizer in the composition CR. Then the core-provider will safely delete the CRD."]}),"\n",(0,o.jsx)(n.p,{children:"Deleting the finalizer in the CRD can cause problems with Kubernetes etcd, so it is not recommended. See section 5. Error after creating CompositionDefinition for troubleshooting."}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting-guide",children:"Troubleshooting Guide"}),"\n",(0,o.jsx)(n.h3,{id:"common-issues-and-diagnostic-procedures",children:"Common Issues and Diagnostic Procedures"}),"\n",(0,o.jsx)(n.h4,{id:"1-compositiondefinition-not-becoming-ready",children:"1. CompositionDefinition Not Becoming Ready"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'CompositionDefinition remains in "Not Ready" state'}),"\n",(0,o.jsx)(n.li,{children:"No corresponding controller pod created"}),"\n",(0,o.jsx)(n.li,{children:"CRD not generated"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check CompositionDefinition status details\nkubectl describe compositiondefinition <name> -n <namespace>\n\n# Examine core provider logs for processing errors\nkubectl logs -n krateo-system -l app=core-provider --tail=100\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Look For:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'In the describe output: Check "Status.Conditions" for error messages'}),"\n",(0,o.jsx)(n.li,{children:"In core provider logs: Look for chart download or CRD generation failures"}),"\n",(0,o.jsx)(n.li,{children:"Verify network connectivity to the chart repository"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-compositions-failing-to-deploy",children:"2. Compositions Failing to Deploy"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'GithubScaffoldingLifecycle resource stuck in "Not Ready" state'}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Get detailed status of the composition\nkubectl describe githubscaffoldinglifecycles <name> -n cheatsheet-system\n\n# Check controller logs for reconciliation errors\nkubectl logs -n cheatsheet-system -l app.kubernetes.io/name=githubscaffoldinglifecycles-controller\n\n# Verify ArgoCD application status\nkubectl get application -n krateo-system\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What to Examine:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Events section in describe output for resource creation failures"}),"\n",(0,o.jsx)(n.li,{children:"Controller logs for Git operations or resource deployment errors"}),"\n",(0,o.jsx)(n.li,{children:"ArgoCD application health and sync status"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"3-upgraderollback-failures",children:"3. Upgrade/Rollback Failures"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Version transition stuck"}),"\n",(0,o.jsx)(n.li,{children:"Mixed version resources"}),"\n",(0,o.jsx)(n.li,{children:"Controller crash loops"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check rollout status of controller deployment\nkubectl rollout status deployment/githubscaffoldinglifecycles-v0-0-2-controller -n cheatsheet-system\n\n# Verify resource versions\nkubectl get all -n githubscaffolding-app -l krateo.io/composition-version\n\n# Compare desired vs actual state\nkubectl get githubscaffoldinglifecycles -n cheatsheet-system -o yaml\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Investigation Areas:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Resource version labels consistency"}),"\n",(0,o.jsx)(n.li,{children:"Controller pod logs for reconciliation errors"}),"\n",(0,o.jsx)(n.li,{children:"Helm release history for the composition"}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"4a-certificate-issues-webhook-failure---valid-only-for-versions-of-core-provider-after-0242",children:"4a. Certificate Issues: Webhook Failure - Valid ONLY for versions of core-provider after 0.24.2"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You receive an error like ",(0,o.jsx)(n.code,{children:"x509: certificate signed by unknown authority"})]}),"\n",(0,o.jsx)(n.li,{children:"You cannot create/get/list/delete the related composition in the cluster"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Something went wrong with the automatic rotation of the webhook certificates managed by the core-provider. To force the rotation of the certificates, you need to restart the core-provider pod.\n",(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# List core-provider pods\nkubectl get pods -n krateo-system -l app=core-provider\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remediation Steps:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Restart the core-provider pod to trigger certificate rotation"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl delete pod -n krateo-system -l app=core-provider\n"})}),"\n",(0,o.jsx)(n.h4,{id:"4b-certificate-issues-mutating-webhook-configuration---valid-only-for-versions-of-core-provider-before-0242",children:"4b. Certificate Issues: Mutating Webhook Configuration - Valid ONLY for versions of core-provider before 0.24.2"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note:"})," This issue is only valid for versions of core-provider before 0.24.2. In versions after this, the management of certificates is automatically handled by the core-provider and you should not face this issue."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You receive an error like ",(0,o.jsx)(n.code,{children:'Internal error occurred: failed calling webhook "core.provider.krateo.io": failed to call webhook: Post "https://core-provider-webhook- service.krateo-v2-system.svc:9443/mutate? timeout=10s": t|s: failed to verify certificate: x509: certificate signed by unknown authority (possibly because of "crypto/rsa: verification error" while trying to verify candidate authority certificate "core-provider-webhook- service.krateo-v2-system.svc")'})]}),"\n",(0,o.jsx)(n.li,{children:"You cannot create the related composition in the cluster"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check the caBundle in the core-provider-webhook-service\nkubectl get mutatingWebhookConfiguration core-provider -o jsonpath='{.webhooks[0].clientConfig.caBundle}' \n\n# Check if the base64 encoded caBundle is aligned with the core-provider tls secret\nkubectl get secret core-provider-certs -n krateo-system -o json | jq -r '.data[\"tls.crt\"]'\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you receive the error described above, the caBundle is not aligned with the core-provider tls secret. So you need to patch the caBundle in the core-provider mutatingWebhookConfiguration."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remediation Steps:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Patch the caBundle in the core-provider mutatingWebhookConfiguration using the command provided above."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'caBundle=$(kubectl get secret core-provider-certs -n krateo-system -o json | jq -r \'.data["tls.crt"]\')\nkubectl patch mutatingWebhookConfiguration core-provider \\\n  --type=\'json\' \\\n  -p=\'[{"op": "replace", "path": "/webhooks/0/clientConfig/caBundle", "value": "\'"$caBundle"\'"}]\'\n'})}),"\n",(0,o.jsx)(n.h4,{id:"41-certificate-issues-conversion-webhook-configuration",children:"4.1 Certificate Issues: Conversion Webhook Configuration"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You receive an error like ",(0,o.jsx)(n.code,{children:'conversion webhook for composition.krateo.io/v0-0-13, Kind=KrateoTemplateToolAwsGlueJobs failed: Post \\"https://core-provider-webhook-service.krateo-v2-system.svc:9443/convert?timeout=30s\\": tls: failed to verify certificate: x509: certificate signed by unknown authority'})]}),"\n",(0,o.jsx)(n.li,{children:"You cannot create the related composition in the cluster"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check the caBundle in the core-provider-webhook-service\nkubectl get crds <your-crd-name> -o jsonpath='{.spec.conversion.webhook.clientConfig.caBundle}'\n# Check if the base64 encoded caBundle is aligned with the core-provider tls secret\nkubectl get secret core-provider-certs -n krateo-system -o json | jq -r '.data[\"tls.crt\"]'\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remediation Steps:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Patch the caBundle in the core-provider mutatingWebhookConfiguration using the command provided above."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'caBundle=$(kubectl get secret core-provider-certs -n krateo-system -o json | jq -r \'.data["tls.crt"]\')\nkubectl patch crd <your-crd-name> \\\n  --type=\'json\' \\\n  -p=\'[{"op": "replace", "path": "/spec/conversion/webhook/clientConfig/caBundle", "value": "\'"$caBundle"\'"}]\'\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You will need to replace ",(0,o.jsx)(n.code,{children:"<your-crd-name>"})," with the name of the CRD you are trying to create."]}),"\n",(0,o.jsx)(n.h4,{id:"5-error-after-creating-compositiondefinition",children:"5. Error after creating CompositionDefinition"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You receive an error like ",(0,o.jsx)(n.code,{children:"request to convert CR from an invalid group/version: composition.krateo.io/vacuum"})]}),"\n",(0,o.jsx)(n.li,{children:"You cannot create the related composition in the cluster"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Diagnostic Steps:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# This error is usually present in the Kubernetes API server logs, in core-provider logs, and is also generally present when listing `compositions`\n\nkubectl get compositions -A\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remediation Steps:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["To solve this issue, you need to force core-provider to re-create the ",(0,o.jsx)(n.code,{children:"vacuum"})," version in the CRD. You can do this changing the version of the chart in the ",(0,o.jsx)(n.code,{children:"CompositionDefinition"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"general-diagnostic-tools",children:"General Diagnostic Tools"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Cluster-wide event inspection\nkubectl get events -A --sort-by=\'.metadata.creationTimestamp\' | grep -i "error\\|fail"\n\n# Cross-namespace pod status check\nkubectl get pods -A -o wide | grep -E "krateo-system|fireworksapp-system"\n\n# API resource verification\nkubectl api-resources | grep fireworksapp\n\n# Network connectivity tests\nkubectl run -it --rm --restart=Never network-test \\\n  --image=alpine -n fireworksapp-system -- \\\n  ping charts.krateo.io\n'})}),"\n",(0,o.jsx)(n.h3,{id:"common-solutions",children:"Common Solutions"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Authentication Issues:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Regenerate Service token with correct scopes"}),"\n",(0,o.jsx)(n.li,{children:"Recreate the secret with proper formatting"}),"\n",(0,o.jsx)(n.li,{children:"Verify network policies allow outbound connections"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Version Conflicts:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Manually clean up orphaned resources"}),"\n",(0,o.jsx)(n.li,{children:"Delete and recreate the CompositionDefinition"}),"\n",(0,o.jsx)(n.li,{children:"Verify chart compatibility between versions"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Resource Constraints:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Check pod resource limits and node availability"}),"\n",(0,o.jsxs)(n.li,{children:["Review pending pods with ",(0,o.jsx)(n.code,{children:"kubectl get pods --field-selector=status.phase=Pending"})]}),"\n",(0,o.jsx)(n.li,{children:"Increase cluster resources if needed"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>c,M:()=>r});var o=i(1504);const s={},t=o.createContext(s);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);