"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[4896],{6920:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>a,frontMatter:()=>d,metadata:()=>c,toc:()=>l});var t=s(7624),r=s(2172);const d={},i="snowplow-RESTAction",c={id:"key-concepts/kcp/snowplow-RESTAction",title:"snowplow-RESTAction",description:"This document provides an overview of the RESTAction CRD and its properties to facilitate its usage within Kubernetes environments.",source:"@site/docs/20-key-concepts/20-kcp/21-snowplow-RESTAction.md",sourceDirName:"20-key-concepts/20-kcp",slug:"/key-concepts/kcp/snowplow-RESTAction",permalink:"/key-concepts/kcp/snowplow-RESTAction",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:21,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"snowplow",permalink:"/key-concepts/kcp/snowplow"},next:{title:"authn",permalink:"/key-concepts/kcp/authn"}},o={},l=[{value:"Overview",id:"overview",level:2},{value:"Schema <code>spec</code> Details",id:"schema-spec-details",level:2},{value:"<code>api</code> Array Item Properties",id:"api-array-item-properties",level:4},{value:"<code>dependsOn</code> Object Properties",id:"dependson-object-properties",level:4},{value:"<code>endpointRef</code> Object Properties",id:"endpointref-object-properties",level:4},{value:"<code>status</code> Properties",id:"status-properties",level:3},{value:"Examples",id:"examples",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"snowplow-restaction",children:"snowplow-RESTAction"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This document provides an overview of the ",(0,t.jsx)(n.code,{children:"RESTAction"})," CRD and its properties to facilitate its usage within Kubernetes environments."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"RESTAction"})," Custom Resource Definition (CRD) allows users to declaratively define calls to APIs that may depend on other API calls."]}),"\n",(0,t.jsxs)(n.h2,{id:"schema-spec-details",children:["Schema ",(0,t.jsx)(n.code,{children:"spec"})," Details"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"api"})}),(0,t.jsx)(n.td,{children:"array"}),(0,t.jsx)(n.td,{children:"Defines API requests to an HTTP service."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"filter"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"A JQ filter that can be applied to the global response."})]})]})]}),"\n",(0,t.jsxs)(n.h4,{id:"api-array-item-properties",children:[(0,t.jsx)(n.code,{children:"api"})," Array Item Properties"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["A single ",(0,t.jsx)(n.code,{children:"api"})," item defines an HTTP REST call.\nThe invoked API ",(0,t.jsxs)(n.strong,{children:["must produce a ",(0,t.jsx)(n.code,{children:"JSON"})," content type"]})]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dependsOn"})}),(0,t.jsx)(n.td,{children:"object"}),(0,t.jsx)(n.td,{children:"Defines dependencies on other APIs."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"endpointRef"})}),(0,t.jsx)(n.td,{children:"object"}),(0,t.jsx)(n.td,{children:"References an Endpoint object."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"filter"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"A JQ expression for response processing."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"headers"})}),(0,t.jsx)(n.td,{children:"array of strings"}),(0,t.jsx)(n.td,{children:"Custom request headers (each header can be a JQ expression)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Unique identifier for the API request."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"path"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Request URI path (can be a JQ expression)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"payload"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Request body payload (can be a JQ expression)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"verb"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"HTTP method (defaults to GET if omitted)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"continueOnError"})}),(0,t.jsx)(n.td,{children:"bool"}),(0,t.jsx)(n.td,{children:"Controls behavior on HTTP errors; if true, it continues processing other APIs, otherwise (default: false), it stops."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"errorKey"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'Used when continueOnError=true, defines the key name in the JSON results for storing error details (default: "error").'})]})]})]}),"\n",(0,t.jsxs)(n.h4,{id:"dependson-object-properties",children:[(0,t.jsx)(n.code,{children:"dependsOn"})," Object Properties"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"iterator"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"A JQ expression that returns a JSON array on which to iterate."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Name of another API on which this depends."})]})]})]}),"\n",(0,t.jsxs)(n.h4,{id:"endpointref-object-properties",children:[(0,t.jsx)(n.code,{children:"endpointRef"})," Object Properties"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Reference to a Kubernetes secret that describes the HTTP REST API endpoint."}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Name of the referenced object."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"namespace"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Namespace of the referenced object."})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"status-properties",children:[(0,t.jsx)(n.code,{children:"status"})," Properties"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"status"})," field is an open-ended object that preserves unknown fields for storing results of all the ",(0,t.jsx)(n.code,{children:"api"})," calls."]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsxs)(n.p,{children:["Some ",(0,t.jsx)(n.code,{children:"RESTAction"})," examples can be found ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/snowplow/tree/main/testdata/restactions/",children:"here"}),". Lets check the one that query ",(0,t.jsx)(n.a,{href:"https://jsonplaceholder.typicode.com",children:"jsonplaceholder.typicode.com"})," API:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: Secret\ntype: Opaque\nmetadata:\n  name: typicode-endpoint\n  namespace: demo-system\nstringData:\n  server-url: https://jsonplaceholder.typicode.com\n---\napiVersion: templates.krateo.io/v1\nkind: RESTAction\nmetadata:\n  name: typicode\n  namespace: demo-system\nspec:\n  filter: "[.todos[] as $todo | .users[] | select(.id == $todo.userId) | { name: .name, id: $todo.id, title: $todo.title, completed: $todo.completed }]"\n  api:\n  - name: users\n    path: "/users"\n    endpointRef:\n      name: typicode-endpoint\n      namespace: demo-system\n    filter: map(select(.email | endswith(".biz")))\n  - name: todos\n    dependsOn: \n      name: users\n      iterator: .users\n    path: ${ "/todos?userId=" + (.id|tostring) }\n    headers:\n      - ${ "X-UserID:" + (.id|tostring) }\n    endpointRef:\n      name: typicode-endpoint\n      namespace: demo-system\n'})})]})}function a(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>c,M:()=>i});var t=s(1504);const r={},d=t.createContext(r);function i(e){const n=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);