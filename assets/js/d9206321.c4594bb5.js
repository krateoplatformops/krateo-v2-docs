"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[840],{576:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>a});var n=i(7624),o=i(2172);const s={},r="composition-dynamic-controller",l={id:"key-concepts/kco/composition-dynamic-controller",title:"composition-dynamic-controller",description:"The composition-dynamic-controller is an operator that is instantiated by the core-provider to manage the Custom Resources whose Custom Resource Definition is generated by the core-provider.",source:"@site/docs/20-key-concepts/10-kco/20-composition-dynamic-controller.md",sourceDirName:"20-key-concepts/10-kco",slug:"/key-concepts/kco/composition-dynamic-controller",permalink:"/key-concepts/kco/composition-dynamic-controller",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"core-provider",permalink:"/key-concepts/kco/core-provider"},next:{title:"provider-runtime",permalink:"/key-concepts/kco/provider-runtime"}},c={},a=[{value:"Summary",id:"summary",level:2},{value:"Overview",id:"overview",level:2},{value:"Examples",id:"examples",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Operator Env Vars",id:"operator-env-vars",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.M)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"composition-dynamic-controller",children:"composition-dynamic-controller"}),"\n",(0,n.jsxs)(t.p,{children:["The composition-dynamic-controller is an operator that is instantiated by the ",(0,n.jsx)(t.a,{href:"https://github.com/krateoplatformops/core-provider",children:"core-provider"})," to manage the Custom Resources whose Custom Resource Definition is generated by the core-provider."]}),"\n",(0,n.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#summary",children:"Summary"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#overview",children:"Overview"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#examples",children:"Examples"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"#configuration",children:"Configuration"})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(t.p,{children:["The composition-dynamic-controller is an operator designed to manage the lifecycle of a Helm chart based on specifications defined within its Custom Resource (CR) and the actions performed on ",(0,n.jsx)(t.a,{href:"https://github.com/krateoplatformops/core-provider/blob/1233e2a80ebaa4ef7816596b27f64d820e9b2f26/testdata/compositiondefinition-postgresql-oci.yaml",children:"this CR"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["In practice, when a Custom Resource (CR) is created, the instance of composition-dynamic-controller enabled to manage this specific Group Version Kind (GVK), checks if a Helm release associated with the CR already exists in the cluster. If not, it performs an ",(0,n.jsx)(t.code,{children:"helm install"})," using the values specified in the CR to create a new release. However, if the release does already exist, it instead executes an ",(0,n.jsx)(t.code,{children:"helm upgrade"}),", updating the release's values with those specified in the CR. Additionally, when the CR is deleted from the cluster, the instance of the composition-dynamic-controller performs an ",(0,n.jsx)(t.code,{children:"helm uninstall"})," on the release."]}),"\n",(0,n.jsx)(t.p,{children:'The status of the composition definition is True if the resources contained in the chart with conditions have a positive type equal to True (positive types are "ready", "complete", "healthy", "active", "able").'}),"\n",(0,n.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"apiVersion: composition.krateo.io/v12-8-3\nkind: Postgresql\nmetadata:\n  name: sample\n  namespace: krateo-system\nspec:\n  architecture: standalone\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The manifest described above represents a Custom Resource (CR) of kind Postgresql, and its apiVersion is composition.krateo.io/v12-8-3. This CRD was generated by the core-provider based on the specifications outlined in ",(0,n.jsx)(t.a,{href:"https://github.com/krateoplatformops/core-provider/blob/1233e2a80ebaa4ef7816596b27f64d820e9b2f26/testdata/compositiondefinition-postgresql-oci.yaml",children:"the CompositionDefinition"}),". Applying this manifest within the cluster initiates the installation of a chart associated with the corresponding instance of the composition-dynamic-controller."]}),"\n",(0,n.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsx)(t.h3,{id:"operator-env-vars",children:"Operator Env Vars"}),"\n",(0,n.jsx)(t.p,{children:"These enviroment varibles can be changed in the Deployment of the composition-dynamic-controller we need to tweak."}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default Value"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_DEBUG"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"dump verbose output"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_WORKERS"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"number of workers"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"1"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_RESYNC_INTERVAL"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"resync interval"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"3m"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_GROUP"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"resource api group"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_VERSION"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"resource api version"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_RESOURCE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"resource plural name"}),(0,n.jsx)(t.td,{style:{textAlign:"left"}})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,o.M)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},2172:(e,t,i)=>{i.d(t,{I:()=>l,M:()=>r});var n=i(1504);const o={},s=n.createContext(o);function r(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);