"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[2840],{576:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var s=n(7624),i=n(2172);const l={},r="composition-dynamic-controller",o={id:"key-concepts/kco/composition-dynamic-controller",title:"composition-dynamic-controller",description:"The composition-dynamic-controller is an operator that is instantiated by the core-provider to manage the Custom Resources whose Custom Resource Definition is generated by the core-provider.",source:"@site/docs/20-key-concepts/10-kco/20-composition-dynamic-controller.md",sourceDirName:"20-key-concepts/10-kco",slug:"/key-concepts/kco/composition-dynamic-controller",permalink:"/key-concepts/kco/composition-dynamic-controller",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"core-provider-cheatsheet",permalink:"/key-concepts/kco/core-provider-cheatsheet"},next:{title:"provider-runtime",permalink:"/key-concepts/kco/provider-runtime"}},c={},d=[{value:"Summary",id:"summary",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Workflow",id:"workflow",level:2},{value:"<strong>Composition Dynamic Controller (CDC) &amp; Chart Inspector: Secure Helm Lifecycle Management</strong>",id:"composition-dynamic-controller-cdc--chart-inspector-secure-helm-lifecycle-management",level:3},{value:"<strong>Core CDC Workflow (with Chart Inspector Integration)</strong>",id:"core-cdc-workflow-with-chart-inspector-integration",level:4},{value:"<strong>Key Capabilities Enabled by This Collaboration</strong>",id:"key-capabilities-enabled-by-this-collaboration",level:3},{value:"<strong>Why This Architecture Matters</strong>",id:"why-this-architecture-matters",level:3},{value:"<strong>Real-World Example: Handling a Breaking Chart Change</strong>",id:"real-world-example-handling-a-breaking-chart-change",level:3},{value:"Composition Dynamic Controller Values Injection",id:"composition-dynamic-controller-values-injection",level:2},{value:"About the <code>gracefullyPaused</code> value",id:"about-the-gracefullypaused-value",level:3},{value:"How it works:",id:"how-it-works",level:4},{value:"Use cases:",id:"use-cases",level:4},{value:"Comparison with <code>krateo.io/paused</code>:",id:"comparison-with-krateoiopaused",level:4},{value:"How to include the pause in a resource included in the chart",id:"how-to-include-the-pause-in-a-resource-included-in-the-chart",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Operator Env Vars",id:"operator-env-vars",level:3}];function a(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"composition-dynamic-controller",children:"composition-dynamic-controller"}),"\n",(0,s.jsxs)(t.p,{children:["The composition-dynamic-controller is an operator that is instantiated by the ",(0,s.jsx)(t.a,{href:"https://github.com/krateoplatformops/core-provider",children:"core-provider"})," to manage the Custom Resources whose Custom Resource Definition is generated by the core-provider."]}),"\n",(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#summary",children:"Summary"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#architecture",children:"Architecture"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#overview",children:"Overview"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#examples",children:"Examples"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"#configuration",children:"Configuration"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"composition-dynamic-controller architecture",src:n(9796).c+"",title:"composition-dynamic-controller Architecture",width:"523",height:"352"})}),"\n",(0,s.jsx)(t.h2,{id:"workflow",children:"Workflow"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"composition-dynamic-controller State Diagram",src:n(9109).c+"",title:"composition-dynamic-controller State Diagram",width:"2958",height:"838"})}),"\n",(0,s.jsx)(t.h3,{id:"composition-dynamic-controller-cdc--chart-inspector-secure-helm-lifecycle-management",children:(0,s.jsx)(t.strong,{children:"Composition Dynamic Controller (CDC) & Chart Inspector: Secure Helm Lifecycle Management"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.strong,{children:"Composition Dynamic Controller (CDC)"})," is a specialized Kubernetes operator that orchestrates the end-to-end lifecycle of Krateo compositions. Acting as the reconciliation engine for Composition custom resources, it bridges declarative application definitions with Helm\u2019s packaging system through intelligent automation. The ",(0,s.jsx)(t.strong,{children:"Chart Inspector"}),' serves as its "safety advisor," enabling proactive decision-making via dry-run analysis.']}),"\n",(0,s.jsx)(t.h4,{id:"core-cdc-workflow-with-chart-inspector-integration",children:(0,s.jsx)(t.strong,{children:"Core CDC Workflow (with Chart Inspector Integration)"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Reconciliation Trigger"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Watches for changes to ",(0,s.jsx)(t.code,{children:"Composition"})," CRs or Helm chart versions."]}),"\n",(0,s.jsxs)(t.li,{children:["Invokes the ",(0,s.jsx)(t.strong,{children:"Chart Inspector"})," to simulate installations/upgrades ",(0,s.jsx)(t.em,{children:"before"})," execution."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Dry-Run Analysis Phase"})," (",(0,s.jsx)(t.em,{children:"Chart Inspector"}),")"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"helm install --dry-run=server <chart> --version <ver>  # Returns:\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Resource Manifest List"}),": All Kubernetes objects (Deployments, CRDs, etc.) the chart would create along with filename to ."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Dependency Graph"}),": Order of operations (e.g., CRDs before custom resources)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"RBAC Auto-Provisioning"})," (",(0,s.jsx)(t.em,{children:"CDC"}),")"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Dynamically generates ",(0,s.jsx)(t.strong,{children:"least-privilege"})," Roles/ClusterRoles based on the Inspector\u2019s output."]}),"\n",(0,s.jsxs)(t.li,{children:["Ensures the CDC\u2019s service account has ",(0,s.jsx)(t.em,{children:"exactly"})," the permissions needed\u2014no more, no less."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Atomic Execution"})," (",(0,s.jsx)(t.em,{children:"CDC"}),")"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Proceeds with ",(0,s.jsx)(t.code,{children:"helm install/upgrade"})," ",(0,s.jsx)(t.em,{children:"only"})," after successful dry-run and RBAC setup."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"key-capabilities-enabled-by-this-collaboration",children:(0,s.jsx)(t.strong,{children:"Key Capabilities Enabled by This Collaboration"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Feature"})}),(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"CDC\u2019s Role"})}),(0,s.jsx)(t.th,{children:(0,s.jsx)(t.strong,{children:"Chart Inspector\u2019s Contribution"})})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Version-Sensitive Reconciliation"})}),(0,s.jsx)(t.td,{children:"Detects chart version drift; rolls forward/back."}),(0,s.jsx)(t.td,{children:"Identifies version-specific resource changes during dry-run."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Atomic Upgrades"})}),(0,s.jsx)(t.td,{children:"Ensures all-or-nothing upgrades."}),(0,s.jsx)(t.td,{children:"Pre-flights resource compatibility (e.g., CRD schema changes)."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Self-Healing"})}),(0,s.jsx)(t.td,{children:"Corrects configuration drift."}),(0,s.jsx)(t.td,{children:'Provides baseline "desired state" for comparison.'})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Declarative Enforcement"})}),(0,s.jsx)(t.td,{children:"Continuously reconciles actual vs. desired state."}),(0,s.jsxs)(t.td,{children:["Supplies the desired state ",(0,s.jsx)(t.em,{children:"before"})," cluster changes."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Secure RBAC"})}),(0,s.jsx)(t.td,{children:"Generates minimal required permissions."}),(0,s.jsx)(t.td,{children:"Audits chart manifests for required API operations."})]})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"why-this-architecture-matters",children:(0,s.jsx)(t.strong,{children:"Why This Architecture Matters"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Safety Net"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'The Chart Inspector\u2019s dry-run prevents "helm surprises" (e.g., undeclared CRD creations or namespace pollution).'}),"\n",(0,s.jsxs)(t.li,{children:["Example: Blocks a chart upgrade if the new version requires a ",(0,s.jsx)(t.code,{children:"ClusterRole"})," the CDC isn\u2019t authorized to manage."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"GitOps Compliance"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["The CDC enforces ",(0,s.jsx)(t.em,{children:"declarative intent"})," by reconciling against the dry-run\u2019s output, not just Helm\u2019s last-applied state."]}),"\n",(0,s.jsx)(t.li,{children:"Self-healing kicks in if manual changes violate the composition\u2019s definition."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Multi-Tenancy Ready"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"RBAC is scoped per-composition, isolating teams/projects."}),"\n",(0,s.jsx)(t.li,{children:"The Inspector\u2019s resource listing ensures no cross-tenant leakage (e.g., a composition can\u2019t create resources in forbidden namespaces)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"real-world-example-handling-a-breaking-chart-change",children:(0,s.jsx)(t.strong,{children:"Real-World Example: Handling a Breaking Chart Change"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Scenario"}),": A Helm chart v1.2.0 introduces a new ",(0,s.jsx)(t.code,{children:"CustomResourceDefinition"})," (CRD)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"CDC+Inspector Flow"}),":","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Dry-run"})," detects the new CRD and its required API group permissions."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"CDC"})," creates a ",(0,s.jsx)(t.code,{children:"ClusterRole"})," granting ",(0,s.jsx)(t.code,{children:"create/get/list"})," for the CRD."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Upgrade"})," proceeds ",(0,s.jsx)(t.em,{children:"only after"})," the CRD and RBAC are confirmed active."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Result"}),': Zero downtime; no "helm upgrade failed: CRD missing" errors.']}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"composition-dynamic-controller-values-injection",children:"Composition Dynamic Controller Values Injection"}),"\n",(0,s.jsx)(t.p,{children:"The composition-dynamic-controller inject labels and values into the installed resources and in the helm chart release values. This values contains informations about the composition resource associated with the helm release.\nThe values are injected in the following way:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Helm Chart Release Values"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Installed Resources Labels"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionId"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-id"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The composition resource uid"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionName"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-name"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The composition resource name"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionNamespace"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-namespace"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The composition resource namespace"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionInstalledVersion"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-installed-version"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The version of the composition resource installed. This value changes if the chart version is upgraded"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionApiVersion"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"not injected"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The api version of the composition resource. This values is deprecated but is mainteined for backward compatibility."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionGroup"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-group"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The group of the composition resource."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionResource"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-resource"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The plural name of the composition resource."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.compositionKind"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/composition-kind"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The kind of the composition resource."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.krateoNamespace"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"krateo.io/krateo-namespace"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The namespace where Krateo is installed. This value is used to identify the Krateo resources in the cluster."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"global.gracefullyPaused"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"not injected"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["This value is set to ",(0,s.jsx)(t.code,{children:"true"})," if the annotation ",(0,s.jsx)(t.code,{children:"krateo.io/gracefully-paused"})," is set on the composition resource. This value is used to pause the reconciliation of the composition resource only after the value is injected in the helm release values with a successful helm upgrade. Read the ",(0,s.jsx)(t.a,{href:"#about-the-gracefullypaused-value",children:"paragraph below"})," for more details."]})]})]})]}),"\n",(0,s.jsxs)(t.h3,{id:"about-the-gracefullypaused-value",children:["About the ",(0,s.jsx)(t.code,{children:"gracefullyPaused"})," value"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"global.gracefullyPaused"})," value provides a way to gracefully pause both the composition resource and all Krateo resources within its Helm chart."]}),"\n",(0,s.jsx)(t.h4,{id:"how-it-works",children:"How it works:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Trigger"}),": Set the annotation ",(0,s.jsx)(t.code,{children:"krateo.io/gracefully-paused"})," on the composition resource"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Activation"}),": The pause takes effect only after the next successful Helm upgrade injects this value into the chart"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Scope"}),": Pauses both the composition reconciliation AND any Krateo resources in the chart that respect the ",(0,s.jsx)(t.code,{children:"krateo.io/paused"})," annotation"]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"use-cases",children:"Use cases:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Graceful pause"}),": Temporarily halt all composition-related activity without resource deletion"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Coordinated pause"}),": Ensure both the composition and its managed resources pause simultaneously"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Safe maintenance"}),": Pause operations during maintenance windows"]}),"\n"]}),"\n",(0,s.jsxs)(t.h4,{id:"comparison-with-krateoiopaused",children:["Comparison with ",(0,s.jsx)(t.code,{children:"krateo.io/paused"}),":"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Annotation"}),(0,s.jsx)(t.th,{children:"Scope"}),(0,s.jsx)(t.th,{children:"When it takes effect"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"krateo.io/gracefully-paused"})}),(0,s.jsx)(t.td,{children:"Composition + chart resources"}),(0,s.jsx)(t.td,{children:"After next Helm upgrade"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"krateo.io/paused"})}),(0,s.jsx)(t.td,{children:"Composition only"}),(0,s.jsx)(t.td,{children:"Immediately"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Example"}),": Use ",(0,s.jsx)(t.code,{children:"krateo.io/gracefully-paused"})," when you need to pause an entire application stack, or ",(0,s.jsx)(t.code,{children:"krateo.io/paused"})," for immediate composition-only pausing."]}),"\n",(0,s.jsx)(t.h4,{id:"how-to-include-the-pause-in-a-resource-included-in-the-chart",children:"How to include the pause in a resource included in the chart"}),"\n",(0,s.jsxs)(t.p,{children:["To include the pause in a resource included in the chart, you can use the ",(0,s.jsx)(t.code,{children:"krateo.io/paused"})," annotation on the resource. This will ensure that the resource is paused when the composition is paused."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'apiVersion: git.krateo.io/v1alpha1\nkind: Repo\nmetadata:\n  name: {{ include "fireworks-app.fullname" . }}-repo\n  labels:\n    {{- include "fireworks-app.labels" . | nindent 4 }}\n  annotations:\n    krateo.io/paused: "{{ default false (and .Values.global .Values.global.gracefullyPaused) }}"\nspec:\n...\n'})}),"\n",(0,s.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(t.h3,{id:"operator-env-vars",children:"Operator Env Vars"}),"\n",(0,s.jsx)(t.p,{children:"These enviroment varibles can be changed in the Deployment of the composition-dynamic-controller we need to tweak."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Default Value"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Notes"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_DEBUG"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"dump verbose output"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_WORKERS"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"number of workers"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_RESYNC_INTERVAL"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"resync interval"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3m"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_GROUP"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"resource api group"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["populated by ",(0,s.jsx)(t.code,{children:"core-provider"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_VERSION"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"resource api version"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["populated by ",(0,s.jsx)(t.code,{children:"core-provider"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_RESOURCE"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"resource plural name"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["populated by ",(0,s.jsx)(t.code,{children:"core-provider"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_SA_NAME"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"cdc deployment ServiceAccount name"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["populated by ",(0,s.jsx)(t.code,{children:"core-provider"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_SA_NAMESPACE"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"cdc deployment ServiceAccount namespace"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["populated by ",(0,s.jsx)(t.code,{children:"core-provider"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"URL_PLURALS"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"NOT USED from version 0.17.1 - URL to krateo pluraliser service"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"http://snowplow.krateo-system.svc.cluster.local:8081/api-info/names"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Ignored from version 0.17.1"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"URL_CHART_INSPECTOR"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"url to chart inspector"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"http://chart-inspector.krateo-system.svc.cluster.local:8081/"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"KRATEO_NAMESPACE"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"namespace where krateo is installed"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"krateo-system"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"HELM_REGISTRY_CONFIG_PATH"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"default helm config path"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"/tmp"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"HELM_MAX_HISTORY"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Max Helm History"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"10"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_MAX_ERROR_RETRY_INTERVAL"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The maximum interval between retries when an error occurs. This should be less than the half of the poll interval."}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0m"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_MIN_ERROR_RETRY_INTERVAL"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The minimum interval between retries when an error occurs. This should be less than max-error-retry-interval."}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1m"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"COMPOSITION_CONTROLLER_METRICS_SERVER_PORT"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"The port where the metrics server will be listening. If not set, the metrics server is disabled."}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsx)(t.td,{style:{textAlign:"left"}})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,i.M)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},9796:(e,t,n)=>{n.d(t,{c:()=>s});const s=n.p+"assets/images/composition-dynamic-controller-architecture-60a6cfba3b0966bb6b933f46eca0ecab.png"},9109:(e,t,n)=>{n.d(t,{c:()=>s});const s=n.p+"assets/images/composition-dynamic-controller-flow-19398ce5162fff5f56731c7341efe20c.png"},2172:(e,t,n)=>{n.d(t,{I:()=>o,M:()=>r});var s=n(1504);const i={},l=s.createContext(i);function r(e){const t=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(l.Provider,{value:t},e.children)}}}]);