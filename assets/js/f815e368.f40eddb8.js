"use strict";(self.webpackChunkkrateo_v_2_docs=self.webpackChunkkrateo_v_2_docs||[]).push([[8976],{2312:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var t=a(7624),o=a(2172);const s={},r="finops-database-handler-uploader",i={id:"key-concepts/kcf/finops-components/finops-database-handler-uploader",title:"finops-database-handler-uploader",description:"This service allows to upload python code notebookes into the finops-database-handler through the use of a custom resource. The custom resource can either contain code inline or a API endpoint to a python file.",source:"@site/docs/20-key-concepts/30-kcf/20-finops-components/50-finops-database-handler-uploader.md",sourceDirName:"20-key-concepts/30-kcf/20-finops-components",slug:"/key-concepts/kcf/finops-components/finops-database-handler-uploader",permalink:"/key-concepts/kcf/finops-components/finops-database-handler-uploader",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:50,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"finops-database-handler",permalink:"/key-concepts/kcf/finops-components/finops-database-handler"},next:{title:"finops-prometheus-exporter-generic",permalink:"/key-concepts/kcf/finops-components/finops-prometheus-exporter-generic"}},l={},d=[{value:"Summary",id:"summary",level:2},{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Examples",id:"examples",level:2},{value:"Installation",id:"installation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"finops-database-handler-uploader",children:"finops-database-handler-uploader"}),"\n",(0,t.jsxs)(n.p,{children:["This service allows to upload python code notebookes into the ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler",children:"finops-database-handler"})," through the use of a custom resource. The custom resource can either contain code inline or a API endpoint to a python file."]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#configuration",children:"Configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#examples",children:"Examples"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#installation",children:"Installation"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["To upload a new notebook into the ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler",children:"finops-database-handler"})," you need to create a new ",(0,t.jsx)(n.code,{children:"Notebook"})," custom resource (see ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler-uploader/tree/main/sample_data",children:"sample data"}),"). The field ",(0,t.jsx)(n.code,{children:"type"})," can be either ",(0,t.jsx)(n.code,{children:"inline"})," or ",(0,t.jsx)(n.code,{children:"api"}),". If you use inline, you need to put the notebook code in the ",(0,t.jsx)(n.code,{children:"inline"})," field. Otherwise, if you use the api type, you need to compile the ",(0,t.jsx)(n.code,{children:"api"})," field. See the ",(0,t.jsx)(n.a,{href:"#examples",children:"examples"})," section for more details. The name of the endpoint of the notebook (see ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler?tab=readme-ov-file#api",children:"endpoints for the finops-database-handler"}),") is the name of the custom resource."]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.p,{children:"The finops-database-handler-uploader accepts six environment variables (or parameters):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["WATCH_NAMESPACE: automatically set to the install namespace if you use the ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler-uploader-chart",children:"Helm chart"})]}),"\n",(0,t.jsx)(n.li,{children:"POLLING_INTERVAL: time between reconciles in seconds, defaults to 300"}),"\n",(0,t.jsx)(n.li,{children:"MAX_RECONCILE_RATE: number of concurrent reconciles (i.e., number of workers)"}),"\n",(0,t.jsxs)(n.li,{children:["FINOPS_DATABASE_HANDLER_ENDPOINT_NAME: name of the secret that contains the endpoint for the finops-database-handler, defaults to ",(0,t.jsx)(n.code,{children:"finops-database-handler-endpoint"})]}),"\n",(0,t.jsxs)(n.li,{children:["FINOPS_DATABASE_HANDLER_ENDPOINT_NAMESPACE: namespace of the secret that contains the endpoint for the finops-database-handler, defaults to ",(0,t.jsx)(n.code,{children:"krateo-system"})]}),"\n",(0,t.jsxs)(n.li,{children:["FINOPS_DATABASE_HANDLER_URL_OVERRIDE: if you do not want to use the ",(0,t.jsx)(n.code,{children:"server-url"})," from the endpoint secret, you can put the url here (used for testing purposes)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.p,{children:"Inline example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: finops.krateo.io/v1\nkind: Notebook\nmetadata:\n  name: query\n  namespace: uploader-test\nspec: \n  type: inline\n  inline: |\n    import pip._internal as pip\n    def install(package):\n        pip.main(['install', package])\n    def main():   \n        table_name_arg = sys.argv[5]\n        table_name_key_value = str.split(table_name_arg, '=')\n        if len(table_name_key_value) == 2:\n            if table_name_key_value[0] == 'table_name':\n                table_name = table_name_key_value[1]\n        try:\n            resource_query = f\"SELECT * FROM {table_name}\"\n            cursor.execute(resource_query)\n            raw_data = cursor.fetchall()\n            print(pd.DataFrame(raw_data))\n        finally:\n            cursor.close()\n            connection.close()\n    if __name__ == \"__main__\":\n        try:\n            import pandas as pd\n        except ImportError:\n            install('pandas')\n            import pandas as pd\n        main()\n"})}),"\n",(0,t.jsx)(n.p,{children:"API example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: finops.krateo.io/v1\nkind: Notebook\nmetadata:\n  name: query2\n  namespace: uploader-test\nspec: \n  type: api\n  api: \n    path: "/krateoplatformops/finops-database-handler/refs/heads/main/notebook_samples/query.py"\n    verb: GET\n    endpointRef:\n      name: raw-github\n      namespace: uploader-test\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: raw-github\n  namespace: uploader-test\nstringData:\n  server-url: https://raw.githubusercontent.com\n'})}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(n.p,{children:["The webservice can be installed through the ",(0,t.jsx)(n.a,{href:"https://github.com/krateoplatformops/finops-database-handler-uploader-chart",children:"Helm chart"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"helm repo add krateo https://charts.krateo.io\nhelm repo update krateo\nhelm install finops-database-handler-uploader krateo/finops-database-handler-uploader\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},2172:(e,n,a)=>{a.d(n,{I:()=>i,M:()=>r});var t=a(1504);const o={},s=t.createContext(o);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);